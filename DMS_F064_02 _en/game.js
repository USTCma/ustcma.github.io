window.Editor={env:"production"},window.GameControl={activityId:null,difficult:null,params:null,exitGame(t){console.log("exitActivity"),this.isExist()&&"function"==typeof JSBridge.exitActivity&&JSBridge.exitActivity(t)},isExist:()=>"undefined"!=typeof JSBridge,getProfileInfo(t,i){console.log("getProfileInfo"),this.isExist()&&"function"==typeof JSBridge.getProfileInfo?JSBridge.getProfileInfo(t,t=>{"getProfileInfo:ok"===t.errMsg?i(t.data.profile):(console.log(t.errMsg),i(null))},()=>{i(null)}):i(null)},indicateActivityReady(){console.log("indicateActivityReady"),this.isExist()&&"function"==typeof JSBridge.indicateActivityReady&&JSBridge.indicateActivityReady()},getActivityId(){if(null===this.activityId){this.activityId="";const t=this.getUrlParams();void 0!==t.activityId&&(this.activityId=t.activityId)}return this.activityId},getUrlParams(){if(!this.params){const t={},i=document.location.search;if(""!==i){const e=i.substring(1).split("&");for(const i in e){const s=e[i].split("=");s.length>1&&(t[s[0]]=s[1])}}this.params=t,console.log("url params",this.params)}return this.params},openIframe(t){if(t){const i=document.createElement("iframe");i.id="iframeView",i.src=t,i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.style.width="100%",i.style.height="100%",document.body.appendChild(i),i.focus(),window.closeIframe=this.closeIframe}},closeIframe(){const t=document.querySelector("#iframeView");t&&(t.src="about:blank",document.body.removeChild(t)),window.focus()},loadAssetsComplete(){console.log("loadAssetsComplete"),this.isExist()&&"function"==typeof JSBridge.loadAssetsComplete&&JSBridge.loadAssetsComplete()},uploadUserData(t){console.log(JSON.stringify(t));var i=window.Editor.Config.common.log;console.log("log is "+i),this.isExist()&&"function"==typeof JSBridge.uploadUserData&&window.Editor.Config.common.log&&(console.log("uploadUserData"),JSBridge.uploadUserData(t))},setActivityControl(t){console.log("setActivityControl",t),this.isExist()&&"function"==typeof JSBridge.setActivityControl&&JSBridge.setActivityControl(t)},getActivityDifficult(){if(null===this.difficult){this.difficult=1;const t=this.getUrlParams();void 0!==t.difficult&&(this.difficult=t.difficult)}return console.log("user current difficult "+this.difficult),this.difficult}};var SystemButtonsAssets=function(){return{system_btn_help:{type:"images",value:"system_btn_help.png"},system_btn_sound_off:{type:"images",value:"system_btn_sound_off.png"},system_btn_sound_on:{type:"images",value:"system_btn_sound_on.png"},system_btn_profile:{type:"images",value:"system_btn_profile.png"},system_btn_exit:{type:"images",value:"system_btn_exit.png"},system_btn_exit_disable:{type:"images",value:"system_btn_exit_disable.png"},success_btn_continue:{type:"images",value:"success_btn_continue.png"},ending_char_fail:{type:"images",value:"ending_char_fail.png"},ending_check_complete:{type:"images",value:"ending_check_complete.png"},ending_check_lock:{type:"images",value:"ending_check_lock.png"},ending_bg_white:{type:"images",value:"ending_bg_white.png"},ending_char_complete:{type:"images",value:"ending_char_complete.png"},ending_char_bar:{type:"images",value:"ending_char_bar.png"},ending_frame:{type:"images",value:"ending_frame.png"},ending_btn_tryagain:{type:"images",lang:!0,value:"ending_btn_tryagain.png"},ending_btn_difficult_1:{type:"images",lang:!0,value:"ending_btn_normal.png"},ending_btn_difficult_2:{type:"images",lang:!0,value:"ending_btn_hard.png"},ending_text_allpass:{type:"images",lang:!0,value:"ending_text_allpass.png"},ending_animation_star:{type:"atlas",value:"ending_animation_star.png",json:"ending_animation_star.json"},ending_sound_complete:{type:"audio",lang:!0,value:"ending_sound_complete.mp3"},ending_sound_tryagain:{type:"audio",lang:!0,value:"ending_sound_tryagain.mp3"},ending_sound_allpass:{type:"audio",value:"ending_sound_allpass.mp3"},ending_sound_char:{type:"audio",value:"ending_sound_char.mp3"},ending_sound_continue:{type:"audio",value:"ending_sound_continue.mp3"},ending_sound_unlock:{type:"audio",value:"ending_sound_unlock.mp3"},ending_sound_white:{type:"audio",value:"ending_sound_white.mp3"},ending_sound_end:{type:"audio",value:"ending_sound_end.mp3"},star_burst_big:{type:"atlas",value:"star_burst_big.png",json:"star_burst_big.json"}}},SystemButtons=class extends Phaser.Group{constructor(t,i,e,s,a){super(t),this.init(i,e,s,a),this.sound(),this.createButtons(),this.createTutorialPage(),this.drawChildGroup(),this.drawEndingView(),window.dataManage.dataTimeStart(),window.dataManage.setGameDifficult(this.game.stageIndex)}init(t,i,e,s){this.complete=!0,this.backgroundMusic=this.getSound(t),this.introMusic=this.getSound(i),this.helpMusic=this.getSound(e),this.tutorialImage=this.getImage(s),this.exitCallback=null,this.muteCallback=null,this.helpCallback=null,this.refreshCallback=null,this.profileUrl=null,this.profileCallback=null,this.tutorialEndCallback=null,this.canExit=!1,this.enableTimer=null,this.enableTimerStatus=!1,this.helpCountdownTimer=null,this.exitAnimationTimer=null,this.sparkleTouchSprites=null,this._defaultConfig={mute:{x:1220,y:60,key:"system_btn_sound_on",muteKey:"system_btn_sound_off"},exit:{x:60,y:60,key:"system_btn_exit",disableKey:"system_btn_exit_disable"},help:{x:60,y:660,key:"system_btn_help",intro:"introdcution",playIntro:"help"},profile:{x:60,y:60,key:"system_btn_profile"}}}sound(){if(this.game.isRestart)return;this.backgroundMusic&&!1===this.backgroundMusic.loop&&(this.backgroundMusic.loop=!0),this.introMusic&&this.helpMusic?(this.game.sound.setDecodedCallback([this.introMusic,this.helpMusic],function(){!this.introMusic.isPlaying&&this.introMusic.play()},this),this.introMusic&&this.introMusic.onStop.add(function(){!this.helpMusic.isPlaying&&this.helpMusic.play()},this)):(!this.backgroundMusic.isPlaying&&this.backgroundMusic.play(),this.helpMusic&&this.helpMusic.play());const t=this.getSound("select_lock_difficult_sound");t&&t.isPlaying&&t.fadeOut(500)}createTutorialPage(){!this.game.isRestart&&this.tutorialImage&&(this.tutorialPageMask=this.game.add.graphics(0,0),this.tutorialPageMask.clear(),this.tutorialPageMask.beginFill(0,.8),this.tutorialPageMask.drawRect(0,0,1280,720),this.tutorialPageMask.endFill(),this.add(this.tutorialPageMask),this.tutorialPageMask.inputEnabled=!0,this.tutorialImage&&this.tutorialPageMask.addChild(this.tutorialImage),this.helpMusic&&this.helpMusic.onStop.addOnce(this.removeTutorialPage,this))}createButtons(){let t,i;t=this._defaultConfig.mute,i=this.backgroundMusic&&this.backgroundMusic.paused?t.muteKey:t.key,this.buttonOffest=60,this.muteBtn=this.game.add.button(this.game.width-this.buttonOffest,this.buttonOffest,i,this.muteManage,this),this.muteBtn.anchor.setTo(.5),this.addButtonAnimation(this.muteBtn),this.add(this.muteBtn),t=this._defaultConfig.exit,this.exitBtn=this.game.add.button(this.buttonOffest,this.buttonOffest,t.disableKey,this.exitManage,this),this.exitBtn.anchor.setTo(.5),this.add(this.exitBtn),t=this._defaultConfig.help,this.helpBtn=this.game.add.button(this.buttonOffest,this.game.height-this.buttonOffest,t.key,this.playHelp,this),this.helpBtn.anchor.setTo(.5),this.addButtonAnimation(this.helpBtn),this.add(this.helpBtn),this.helpButtonCountdowmTime(),this.game.Config.common.showProfile&&this.createProfileButton()}createProfileButton(t){const i=this._defaultConfig.profile;this.profileBtn=this.game.add.button(this.buttonOffest,this.buttonOffest,i.key,this.showProfilePage,this),this.profileBtn.visible=!0,this.profileBtn.anchor.setTo(.5),this.addButtonAnimation(this.profileBtn),this.add(this.profileBtn),GameControl.getProfileInfo(t,t=>{t&&(this.profileUrl=t)})}addButtonAnimation(t){t.onInputDown.add(function(){t.scale.setTo(.9,.9),this.game.add.tween(t.scale).to({x:1.1,y:1.1},100,Phaser.Easing.Linear.None,!0,0,0,!1)},this),t.onInputUp.add(function(){this.game.add.tween(t.scale).to({x:1,y:1},100,Phaser.Easing.Linear.None,!0,0,0,!1)},this)}exitManage(){this.canExit&&this.exitGame()}exitGame(){this.exitCallback&&this.exitCallback(),this.hideExitButtonTouchPrompt(),this.showEndingPage("skip"),window.dataManage.btnQuitAction()}muteManage(){this.backgroundMusic&&(this.backgroundMusic.paused?(this.backgroundMusic.resume(),this.muteBtn.loadTexture(this._defaultConfig.mute.key)):(this.backgroundMusic.pause(),this.muteBtn.loadTexture(this._defaultConfig.mute.muteKey))),this.muteCallback&&this.muteCallback()}playHelp(){null===this.introMusic?this.helpMusic&&!this.helpMusic.isPlaying&&this.helpMusic.play():!this.helpMusic||this.introMusic.isPlaying||this.helpMusic.isPlaying||this.helpMusic.play(),!0!==this.game.helpBtnTouch&&(this.game.helpBtnTouch=!0),this.hideHelpButtonTouchPrompt(),this.helpCallback&&this.helpCallback(),window.dataManage.btnHelpAction()}playHelpAudio(){this.helpMusic&&!this.helpMusic.isPlaying&&this.helpMusic.play()}showProfilePage(){this.profileCallback&&this.profileCallback()}getSoundByKey(t){let i=0;const e=this.game.sound._sounds,s=e.length;for(;i<s;i++)if(e[i].key===t)return e[i];return null}getMuteButton(){return this.muteBtn}getHelpButton(){return this.helpBtn}getExitButton(){return this.exitBtn}getProfileButton(){return this.profileBtn}setMuteCallback(t){this.muteCallback=t}setExitCallback(t){this.exitCallback=t}setHelpCallback(t){this.helpCallback=t}setProfileCallback(t){this.profileCallback=t}setTutorialEndCallback(t){this.tutorialEndCallback=t,this.game.isRestart&&(this.tutorialEndCallback(),this.helpButtonCountdowmTime())}setUserInput(){this.enableTimerStatus?this.userInput=!0:(this.enableTimerStatus=!0,this.enableTimer.start())}enableExitButton(t,i){this.exitInterval=t||3e3,this.exitTotalTime=i||3e3,this.grandTotalTime=0,this.userInput=!1,this.enableTimer=this.game.time.create(!1),this.enableTimer.loop(this.exitInterval,this.updateExitButtonStatus,this),this.exitAddInputEventListener()}updateExitButtonStatus(){this.userInput?(this.userInput=!1,this.grandTotalTime+=this.exitInterval,this.grandTotalTime>=this.exitTotalTime&&(this.enableTimer.stop(),this.canExit=!0,this.exitBtn.loadTexture(this._defaultConfig.exit.key),this.exitButtonEnableInputAnimation(),this.addButtonAnimation(this.exitBtn),this.exitDeleteImputEventListener())):this.grandTotalTime=0}updateDisableExitStatus(t){let i;i=this.grandTotalTime>=this.exitTotalTime?1:t?(this.grandTotalTime+this.exitInterval)/this.exitTotalTime:0,this.game.add.tween(this.exitImage).to({alpha:i},this.exitInterval,Phaser.Easing.Linear.None,!0,0,0,!1)}removeTutorialPage(){this.tutorialPageMask.inputEnabled=!1,!this.backgroundMusic.isPlaying&&this.backgroundMusic.play(),this.game.add.tween(this.tutorialPageMask).to({alpha:0},1e3,Phaser.Easing.Linear.None,!0,0,0,!1).onComplete.add(function(){this.tutorialPageMask.destroy(),this.tutorialEndCallback&&this.tutorialEndCallback()},this)}getSound(t){if("string"==typeof t){let i=this.getSoundByKey(t);return i||(i=this.game.add.audio(t)),i}return"object"!=typeof t||Array.isArray(t)?null:t}getImage(t){if("string"==typeof t){const i=this.game.make.image(this.game.world.centerX,this.game.world.centerY,t);return i.anchor.setTo(.5),i}return"object"!=typeof t||Array.isArray(t)?null:t}exitAddInputEventListener(){this.game.input.onDown.has(this.setUserInput,this)||this.game.input.onDown.add(this.setUserInput,this),this.game.input.onUp.has(this.setUserInput,this)||this.game.input.onUp.add(this.setUserInput,this),this.existMoveCallback(this.setMoveUserInput,this)||this.game.input.addMoveCallback(this.setMoveUserInput,this)}exitDeleteImputEventListener(){this.game.input.onDown.has(this.setUserInput,this)&&this.game.input.onDown.remove(this.setUserInput,this),this.game.input.onUp.has(this.setUserInput,this)&&this.game.input.onUp.remove(this.setUserInput,this),this.existMoveCallback(this.setMoveUserInput,this)&&this.game.input.deleteMoveCallback(this.setMoveUserInput,this)}setMoveUserInput(t){t.isDown&&this.setUserInput()}existMoveCallback(t,i){const e=this.game.input.moveCallbacks,s=e.length;for(let a=0;a<s;a++){const s=e[a];if(s.callback===t&&s.context===i)return!0}return!1}helpButtonAddTouchPrompt(t,i){this.game.cache.checkImageKey("sparkle_touch")&&(this.sparkleTouchSprites=this.game.add.sprite(t,i,"sparkle_touch"),this.sparkleTouchSprites.anchor.setTo(.5),this.sparkleTouchSprites.scale.setTo(1.5),this.sparkleTouchSprites.animations.add("sparkle_touch"),this.sparkleTouchSprites.visible=!1)}showHelpButtonTouchPrompt(){this.helpBtn&&this.buttonPromptAnimation(this.helpBtn)}hideHelpButtonTouchPrompt(){this.helpCountdownTimer&&(this.helpCountdownTimer.running&&this.helpCountdownTimer.stop(),this.helpCountdownTimer.destroy(),this.helpCountdownTimer=null)}helpButtonCountdowmTime(){this.helpCountdownTimer||!0===this.game.helpBtnTouch||(this.helpCountdownTimer=this.game.time.create(!1),this.helpCountdownTimer.loop(4e3,this.showHelpButtonTouchPrompt,this),this.helpCountdownTimer.start(1e4))}buttonPromptAnimation(t){if(t){const i=1200;this.game.add.tween(t.scale).to({x:[1,1.2,1],y:[1,1.2,1]},400,null,!0),this.game.add.tween(t).to({angle:[0,-15,15,-15,15,-15,15,0]},i,null,!0)}}exitButtonEnableInputAnimation(){this.exitAnimationTimer||(this.exitAnimationTimer=this.game.time.create(!1),this.exitAnimationTimer.add(0,this.showExitButtonTouchPrompt,this),this.exitAnimationTimer.repeat(4e3,2,this.showExitButtonTouchPrompt,this),this.exitAnimationTimer.start(500))}showExitButtonTouchPrompt(){this.exitBtn&&this.buttonPromptAnimation(this.exitBtn)}hideExitButtonTouchPrompt(){this.exitAnimationTimer&&(this.exitAnimationTimer.running&&this.exitAnimationTimer.stop(),this.exitAnimationTimer.destroy(),this.exitAnimationTimer=null)}createGameSuccess(){this.successGroup=this.game.make.group(),this.add(this.successGroup),this.starAnimaMusic=this.game.add.audio("success_audio_star_animation"),this.btnShowMusic=this.game.add.audio("success_audio_btn"),this.reaxPosMusic=[];const t=["success_audio_reaxpos_1","success_audio_reaxpos_2"];for(let i=0;i<t.length;i++){const e=this.game.add.audio(t[i],2);this.reaxPosMusic.push(e)}this.overMask=this.game.add.graphics(0,0),this.overMask.clear(),this.overMask.beginFill(0,.8),this.overMask.drawRect(0,0,this.game.world.width,this.game.world.height),this.overMask.endFill(),this.overMask.inputEnabled=!0,this.successGroup.add(this.overMask),this.starSprite=this.game.add.sprite(this.game.world.centerX,this.game.world.centerY,"success_star_animation",0),this.starSprite.anchor.setTo(.5,.5),this.starSprite.scale.setTo(1.8),this.successGroup.add(this.starSprite),this.successGroup.visible=!1}drawChildGroup(){this.childGroup=this.game.add.group()}showStarBurst(t,i,e){this.endSound=this.game.add.audio("ending_sound_end"),this.endSound.play();let s=this.game.add.sprite(t,i,"star_burst_big");s.anchor.setTo(.5),this.childGroup.addChild(s);let a=s.animations.add("star_burst_big");a.onComplete.addOnce(function(){e&&e()},this),a.play(15)}showGameSuccess(){if(this.game.showSuccessStatus)return;if(this.successGroup.visible)return;this.game.world.bringToTop(this),this.successGroup.visible=!0,this.starAnimaMusic.play(),this.starAnimation.play(30);var t=this.game.world.centerY+130,i=this.game.world.centerX;this.replayBtn=this.game.add.button(i-190,t,"success_btn_replay",this.playAgain,this),this.replayBtn.anchor.setTo(.5),this.replayBtn.scale.setTo(0),this.successGroup.add(this.replayBtn),this.nextBtn=this.game.add.button(i,t,"success_btn_continue",this.nextStage,this),this.nextBtn.anchor.setTo(.5),this.nextBtn.scale.setTo(0),this.successGroup.add(this.nextBtn),this.continueBtn=this.game.add.button(i+190,t,"success_btn_continue",this.exitControlGame,this),this.continueBtn.anchor.setTo(.5),this.continueBtn.scale.setTo(0),this.successGroup.add(this.continueBtn);const e=this.game.add.tween(this.continueBtn.scale).to({x:[.6,1.3,.8,.96],y:[.6,1.3,.8,.96]},1e3,"Linear",!0,3500);e.onStart.add(function(){this.btnShowMusic.play()},this),e.onComplete.add(function(){this.game.add.tween(this.continueBtn.scale).to({x:[.96,1.04,.96],y:[.96,1.04,.96]},1e3,"Linear",!0,0,-1)},this);const s=this.game.add.tween(this.replayBtn.scale).to({x:[.6,1.3,.8,.96],y:[.6,1.3,.8,.96]},1e3,"Linear",!0,3e3);s.onStart.add(function(){this.btnShowMusic.play()},this),s.onComplete.add(function(){this.game.add.tween(this.replayBtn.scale).to({x:[1.04,.96],y:[1.04,.96]},1e3,"Linear",!0,0,-1)},this);const a=this.game.add.tween(this.nextBtn.scale).to({x:[.6,1.3,.8,.96],y:[.6,1.3,.8,.96]},1e3,"Linear",!0,3e3);a.onStart.add(function(){this.btnShowMusic.play()},this),a.onComplete.add(function(){this.game.add.tween(this.nextBtn.scale).to({x:[1.04,.96],y:[1.04,.96]},1e3,"Linear",!0,0,-1)},this),this.game.time.events.add(500,function(){const t=this.game.math.between(0,1);this.reaxPosMusic[t].play()},this)}setAgainCallback(t){this.refreshCallback=t}playAgain(t){this.againCallback&&this.againCallback(),this.game.stageIndex=t.difficultValue,dataManage.resetData(),this.game.isRestart=!1,this.backgroundMusic.destroy(),this.backgroundMusic=null,this.helpMusic.destroy(),this.helpMusic=null,this.enableTimer&&this.enableTimer.stop(),this.enableTimer=null,this.hideHelpButtonTouchPrompt(),this.overMask.destroy(!0),this.overMask=null,this.endingGroup.destroy(!0),this.endingGroup=null,this.game.sound.removeAll(!0),this.game.state.restart()}hideGameSuccess(){this.replayBtn.destroy(),this.replayBtn=null,this.continueBtn.destroy(),this.continueBtn=null,this.overMask.inputEnabled=!1,this.visible=!1}exitControlGame(){GameControl&&(GameControl.uploadUserData(dataManage.getUserData()),GameControl.exitGame(this.complete))}nextStage(){void 0===this.game.stageIndex&&(this.game.stageIndex=0),this.game.stageIndex<this.game.Config.stages.length-1&&(this.game.stageIndex+=1),this.playAgain()}onAutoPlayWarn(t){this.game.sound.usingWebAudio&&"suspended"===this.game.sound.context.state&&this.game.input.onTap.addOnce(function(){this.game.sound.context.resume(),t.play()},this)}drawEndingView(){this.endingGroup=this.game.add.group(),this.completeSound=this.game.add.audio("ending_sound_complete"),this.tryAgainSound=this.game.add.audio("ending_sound_tryagain"),this.lockSound=this.game.add.audio("select_lock_difficult_sound"),this.allpassSound=this.game.add.audio("ending_sound_allpass"),this.charSound=this.game.add.audio("ending_sound_char"),this.contBtnSound=this.game.add.audio("ending_sound_continue"),this.unlockSound=this.game.add.audio("ending_sound_unlock"),this.whiteSound=this.game.add.audio("ending_sound_white");var t=this.game.add.graphics(0,0);t.clear(),t.beginFill(0,.8),t.drawRect(0,0,this.game.world.width,this.game.world.height),t.endFill(),t.inputEnabled=!0,this.endingGroup.add(t),this.overMask=t,this.contentGroup=this.game.add.group(),this.endingGroup.addChild(this.contentGroup),this.endingGroup.visible=!1,this.add(this.endingGroup)}showEndingPage(t,i){if(this.endingGroup.visible)return;this.helpMusic.isPlaying&&this.helpMusic.fadeOut(500),this.game.world.bringToTop(this),this.complete=this.getComplete(t),this.endingGroup.visible=!0;const e=this.game.difficultValue;this.unlockDifficlut(this.complete);const s=this.game.difficultValue;console.log("current difficult value = "+s),this.complete?this.showEndingCompleteView(s,e):this.showEndingFailView(s,e),window.dataManage.dataTimeEnd(t,i)}showEndingFailView(t){this.tryAgainSound.play();const i=this.game.add.sprite(this.game.world.centerX,0,"ending_char_fail");i.y=i.height/2,i.anchor.set(.5),this.contentGroup.add(i);const e=this.game.add.sprite(this.game.world.centerX,this.game.world.centerY+134,"ending_char_bar");e.anchor.setTo(.5),this.contentGroup.addChild(e);for(let i=0;i<this.game.diffcultLength;i++){var s=null;if(i>t)(s=this.game.add.button(0,0,"ending_check_lock",this.selectUnclock,this)).anchor.set(.5),s.difficultValue=i;else if(i===t){let e=0;2===t?e=10:0===t&&(e=-10),(s=this.game.add.sprite(0,0,"ending_check_lock")).anchor.set(.5);const n=this.game.add.sprite(e,0,"ending_bg_white");n.anchor.set(.5),s.addChild(n);const o=this.game.add.sprite(e,-45,"ending_check_lock");o.anchor.set(.5),s.addChild(o);var a=this.game.stageIndex<t?"ending_btn_difficult_"+i:"ending_btn_tryagain";const h=this.game.add.button(e,50,a,this.playAgain,this);h.difficultValue=i,h.anchor.set(.5),s.addChild(h),this.unlockDiffucultAnimation(s)}else(s=this.game.add.button(0,0,"ending_check_complete",this.playAgain,this)).anchor.set(.5),s.difficultValue=i;var n=1===i?0:0===i?-1:1;s.x=212*n,s.y=-8,e.addChild(s)}const o=this.game.add.button(1152,600,"success_btn_continue",this.exitControlGame,this);o.anchor.setTo(.5),this.continueButtonAnimation(o),this.contentGroup.addChild(o)}showEndingCompleteView(t,i){this.completeSound.play();const e=this.game.add.sprite(this.game.world.centerX,this.game.world.centerY-128,"ending_animation_star");e.scale.set(1.5),e.anchor.set(.5),this.contentGroup.add(e),e.animations.add("start").play(30,!0);let s=200;const a=this.game.add.sprite(this.game.world.centerX,this.game.world.centerY-65+s,"ending_frame");a.anchor.set(.5),this.contentGroup.addChild(a),this.charSpriteAniamtion(a,"-"+s),s=250;const n=this.game.add.sprite(this.game.world.centerX,0,"ending_char_complete");n.y=n.height/2-40+s,n.anchor.set(.5),this.contentGroup.add(n),this.charSpriteAniamtion(n,"-"+s),this.game.time.events.add(167,function(){this.charSound.play()},this);const o=this.game.add.sprite(this.game.world.centerX,this.game.world.centerY+134,"ending_char_bar");o.anchor.setTo(.5),this.contentGroup.addChild(o);for(let e=0;e<this.game.diffcultLength;e++){var h=null;if(e>t)(h=this.game.add.button(0,0,"ending_check_lock",this.selectUnclock,this)).anchor.set(.5),h.difficultValue=e;else if(e===t){(h=this.game.add.sprite(0,0,"ending_check_lock")).anchor.set(.5);let i=0;2===t?i=10:0===t&&(i=-10);const s=this.game.add.sprite(i,0,"ending_bg_white");s.anchor.set(.5),h.addChild(s);const a=this.game.add.sprite(i,-45,"ending_check_lock");a.anchor.set(.5),h.addChild(a);const n=this.game.add.button(i,50,"ending_btn_difficult_"+e,this.playAgain,this);n.difficultValue=e,n.anchor.set(.5),h.addChild(n),this.unlockDiffucultAnimation(h)}else{(h=h=this.game.add.sprite(0,0,"ending_check_lock")).anchor.set(.5);const s=this.game.add.button(0,0,"ending_check_complete",this.playAgain,this);s.difficultValue=e,s.anchor.set(.5),h.addChild(s),e===t-1&&i<t&&this.completeStageAnimation(s)}var r=1===e?0:0===e?-1:1;h.x=212*r,h.y=-8,o.addChild(h)}const l=this.game.add.button(1132,600,"success_btn_continue",this.exitControlGame,this);if(l.anchor.setTo(.5),this.contentGroup.addChild(l),this.continueButtonAnimation(l),t>=this.game.diffcultLength){const t=this.game.add.sprite(this.game.world.centerX,640,"ending_text_allpass");t.anchor.set(.5),this.contentGroup.addChild(t),this.textAnimation(t)}}selectUnclock(){console.log("difficult lock"),this.lockSound&&!this.lockSound.isPlaying&&this.lockSound.play()}getComplete(t){return"complete"===t}unlockDifficlut(t){t&&this.game.difficultValue===this.game.stageIndex&&this.game.difficultValue<this.game.diffcultLength&&(this.game.difficultValue+=1,window.dataManage.setUnloackDifficult(this.game.difficultValue))}charSpriteAniamtion(t,i,e,s){t.scale.set(0,0);this.game.add.tween(t).to({y:i},167,Phaser.Easing.Quadratic.InOut,!0,100),this.game.add.tween(t.scale).to({x:1.05,y:1.05},167,Phaser.Easing.Quadratic.InOut,!0,100).onComplete.add(function(){this.game.add.tween(t.scale).to({x:[.95,1],y:[.95,1]},134,Phaser.Easing.Quadratic.Out,!0).onComplete.addOnce(function(){s&&s()},this)},this)}completeStageAnimation(t){t.alpha=0,t.scale.set(6.4);t.inputEnabled=!1,this.game.add.tween(t).to({alpha:1},134,Phaser.Easing.Linear.None,!0,233);const i=this.game.add.tween(t.scale).to({x:1,y:1},200,Phaser.Easing.Linear.None,!0,233);i.onStart.addOnce(function(){this.unlockSound.play()},this),i.onComplete.add(function(){t.inputEnabled=!0,this.game.add.tween(t.scale).to({x:[1.2,1],y:[1.2,1]},200,Phaser.Easing.Linear.None,!0)},this)}unlockDiffucultAnimation(t){const i=t.getChildAt(0),e=t.getChildAt(1),s=t.getChildAt(2);i.scale.set(0),e.scale.set(0),s.scale.set(0);this.game.add.tween(s.scale).to({x:1.1,y:1.1},167,Phaser.Easing.Linear.None,!0,1e3).onComplete.add(function(){this.game.add.tween(s.scale).to({x:[.95,1],y:[.95,1]},200,Phaser.Easing.Linear.None,!0)},this);this.game.add.tween(e.scale).to({x:1.1,y:1.1},167,Phaser.Easing.Linear.None,!0,1e3).onComplete.add(function(){this.game.add.tween(e.scale).to({x:[.7,1],y:[.7,1]},200,Phaser.Easing.Linear.None,!0)},this);const a=this.game.add.tween(i.scale).to({x:1.05,y:1.05},167,Phaser.Easing.Linear.None,!0,900);a.onStart.addOnce(function(){this.whiteSound.play()},this),a.onComplete.add(function(){this.game.add.tween(i.scale).to({x:[.95,1.025,1],y:[.95,1.025,1]},200,Phaser.Easing.Linear.None,!0)},this)}textAnimation(t){t.scale.setTo(0);const i=this.game.add.tween(t.scale).to({x:1.1,y:1.1},167,Phaser.Easing.Linear.None,!0,1e3);i.onStart.addOnce(function(){this.allpassSound.play()},this),i.onComplete.add(function(){this.game.add.tween(t.scale).to({x:[.95,1],y:[.95,1]},200,Phaser.Easing.Linear.None,!0)},this)}continueButtonAnimation(t){t.scale.setTo(0);const i=this.game.add.tween(t.scale).to({x:[.6,1.3,.8,.9],y:[.6,1.3,.8,.9]},1e3,"Linear",!0,1500);i.onStart.addOnce(function(){this.contBtnSound.play()},this),i.onComplete.add(function(){this.game.add.tween(t.scale).to({x:[1.1,.9],y:[1.1,.9]},700,"Linear",!0,0,-1)},this)}},ReaxAudiosAssets=function(){return{audio_reaxneg_01:{type:"audio",lang:!0,value:"audio_reaxneg_01.mp3"},audio_reaxneg_03:{type:"audio",lang:!0,value:"audio_reaxneg_03.mp3"},audio_reaxneg_05:{type:"audio",lang:!0,value:"audio_reaxneg_05.mp3"},audio_reaxneg_06:{type:"audio",lang:!0,value:"audio_reaxneg_06.mp3"},audio_reaxneg_07:{type:"audio",lang:!0,value:"audio_reaxneg_07.mp3"},audio_reaxneg_08:{type:"audio",lang:!0,value:"audio_reaxneg_08.mp3"},audio_reaxpos_01:{type:"audio",lang:!0,value:"audio_reaxpos_01.mp3"},audio_reaxpos_02:{type:"audio",lang:!0,value:"audio_reaxpos_02.mp3"},audio_reaxpos_03:{type:"audio",lang:!0,value:"audio_reaxpos_03.mp3"},audio_reaxpos_04:{type:"audio",lang:!0,value:"audio_reaxpos_04.mp3"},audio_reaxpos_05:{type:"audio",lang:!0,value:"audio_reaxpos_05.mp3"},audio_reaxpos_06:{type:"audio",lang:!0,value:"audio_reaxpos_06.mp3"},audio_reaxpos_07:{type:"audio",lang:!0,value:"audio_reaxpos_07.mp3"},audio_reaxpos_08:{type:"audio",lang:!0,value:"audio_reaxpos_08.mp3"},audio_reaxpos_09:{type:"audio",lang:!0,value:"audio_reaxpos_09.mp3"},audio_reaxpos_10:{type:"audio",lang:!0,value:"audio_reaxpos_10.mp3"},audio_reaxpos_11:{type:"audio",lang:!0,value:"audio_reaxpos_11.mp3"}}},ReaxAudios=class{constructor(t,i,e){this.game=t,this.isHummming=!1,this.negList=i&&Array.isArray(i)?i:["audio_reaxneg_01","audio_reaxneg_03","audio_reaxneg_05","audio_reaxneg_06","audio_reaxneg_07","audio_reaxneg_08"],this.posList=i&&Array.isArray(e)?e:["audio_reaxpos_01","audio_reaxpos_02","audio_reaxpos_03","audio_reaxpos_04","audio_reaxpos_05","audio_reaxpos_06","audio_reaxpos_07","audio_reaxpos_08","audio_reaxpos_09","audio_reaxpos_10","audio_reaxpos_11"],this.loadAudio()}loadAudio(){this.audioReasNegList=[];for(let t=0;t<this.negList.length;t++)this.audioReasNegList.push(this.game.add.audio(this.negList[t]));this.audioReasPosList=[];for(let t=0;t<this.posList.length;t++)this.audioReasPosList.push(this.game.add.audio(this.posList[t]));this.audioReasGoodJob=[],this.audioReasGoodJob.push(this.game.add.audio(this.posList[1])),this.audioReasWellDone=[],this.audioReasWellDone.push(this.game.add.audio(this.posList[9]))}getRandomItem(t,i=3){if(null==t||t.length<=0)return;let e=[];if(t.length>i){null==t.hasplayed&&(t.hasplayed=[]);for(let i=0;i<t.length;i++){let s=!1;for(let e=0;e<t.hasplayed.length;e++)if(t[i]==t.hasplayed[e]){s=!0;break}s||e.push(t[i])}}else e=t;let s=e[this.game.math.between(0,e.length-1)];if(t.length>i){null==t.hasplayed&&(t.hasplayed=[]);for(let e=i-1;e>=0;e--)t.hasplayed[e]=e>0?t.hasplayed[e-1]:s}return s}playRandomAudio(t,i){if(null==t||t.length<=0)return void(i&&i());let e=this.getRandomItem(t,3);return e.play(),i&&e.onStop.addOnce(function(){i()}),e}showPositiveHumm(t){this.isHummming||(this.isHummming=!0,this.playRandomAudio(this.audioReasPosList,()=>{this.isHummming=!1,t&&t()})),window.dataManage.effectiveAction()}showNegativeHumm(t){this.isHummming||(this.isHummming=!0,this.playRandomAudio(this.audioReasNegList,()=>{this.isHummming=!1,t&&t()})),window.dataManage.faultAction()}playAudioGoodJob(t){this.playRandomAudio(this.audioReasGoodJob,()=>{t&&t()}),window.dataManage.effectiveAction()}playAudioWellDone(t){this.playRandomAudio(this.audioReasWellDone,()=>{t&&t()}),window.dataManage.effectiveAction()}},LoadProgressBarAssets=function(){return{loading_progress:{type:"images",value:"loading_progress.png"},loading_total:{type:"images",value:"loading_total.png"},loading_bg:{type:"images",lang:!0,value:"loading_bg.jpg"}}},LoadProgressBar=class extends Phaser.Group{constructor(t){super(t),this.autoStartGame=t.Config.common.autoStartGame,this.showProgressBar=t.Config.common.showProgressBar,this.processBarSize={w:446,h:52},this.processBarOffset={x:0,y:240},this.createProgressBar(),this.visibilityListener(t)}createProgressBar(){if(!this.showProgressBar)return;this.loadBgSprite=this.game.make.image(this.game.world.centerX,this.game.world.centerY,"loading_bg"),this.loadBgSprite.anchor.set(.5),this.add(this.loadBgSprite);const t=(this.game.width-this.processBarSize.w)/2+this.processBarOffset.x,i=(this.game.height-this.processBarSize.h)/2+this.processBarOffset.y;this.sliderTrack=this.game.add.image(t,i,"loading_total"),this.progressBar=this.game.add.image(t,i,"loading_progress"),this.game.load.setPreloadSprite(this.progressBar),this.add(this.sliderTrack),this.add(this.progressBar),GameControl.indicateActivityReady()}loadComplete(t){const i=window.GameControl.getActivityId();this.game.difficultValue=window.GameControl.getActivityDifficult()-1;const e={deviceModel:window.navigator.userAgent,activityId:i,difficult:this.game.difficultValue};window.dataManage=new DataManage(e);const s=new Object;s.start=t,s.pause=function(){this.paused=!0,console.log("paused game")}.bind(this.game),s.resume=function(){this.paused=!1,console.log("resume game")}.bind(this.game),window.GameControl.setActivityControl(s),t&&t()}visibilityListener(t){document.addEventListener("visibilitychange",()=>{console.log("visibilitychange"),document.hidden?(t.sound.mute||t.sound.setMute(),t.paused=!0):(t.sound.mute||t.sound.unsetMute(),t.paused=!1)},!1)}},GestureTiperAssets=function(){return{gesturetiper_hand:{type:"images",value:"gesturetiper_hand.png"},gesturetiper_star_burst:{type:"atlas",value:"gesturetiper_star_burst.png",json:"gesturetiper_star_burst.json"},gesturetiper_star_little_1:{type:"atlas",value:"gesturetiper_star_little_1.png",json:"gesturetiper_star_little_1.json"},gesturetiper_star_little_2:{type:"atlas",value:"gesturetiper_star_little_2.png",json:"gesturetiper_star_little_2.json"},gesturetiper_star_little_3:{type:"atlas",value:"gesturetiper_star_little_3.png",json:"gesturetiper_star_little_3.json"}}},GestureTiper=class extends Phaser.Group{constructor(t,i={}){super(t),this.game=t,this.keyHand=i.keyHand||"gesturetiper_hand",this.keyStar=i.keyStar||"gesturetiper_star_burst",this.SlideDirection={Horizontal:0,Vertical:1},this.slideOffset={x:150,y:150},this.durationAlphaTween=200,this.durationDragTween=800,this.dragSpeed=4/15,this.easingLinear=Phaser.Easing.Linear.None,this.isTiping=!1,this.visible=!1}loadSprites(t,i){const e={},s=this.game.add.sprite(t.x,t.y,this.keyStar);s.anchor.setTo(.5),s.visible=!1;const a=s.animations.add(this.keyStar);i.addChild(s);const n=this.game.add.group();i.addChild(n);const o=this.game.add.sprite(t.x,t.y,this.keyHand);return o.anchor.setTo(.2),i.addChild(o),e.starSprite=s,e.starAnimation=a,e.handSprite=o,e.trailStarGroup=n,e}showSlide(t,i,e){this.destroy(!0,!0);let s=this.game.add.group();this.addChild(s);const a=this.loadSprites(t,s);this.visible=!0,this.isTiping=!0;let n=this.slideOffset.x,o=this.slideOffset.y;i==this.SlideDirection.Vertical?n=0:o=0;let h=Phaser.Easing.Cubic.Out;const r=this.durationAlphaTween;a.handSprite.alpha=0;let l=this.game.add.tween(a.handSprite);l.to({alpha:1},r,h,!0).onComplete.addOnce(function(){this.game.add.tween(a.handSprite).to({x:a.handSprite.x-n,y:a.handSprite.y-o},700,h,!0).onComplete.addOnce(function(){this.game.add.tween(a.handSprite).to({alpha:0},r,h,!0).onComplete.addOnce(function(){a.handSprite.x=t.x,a.handSprite.y=t.y,d.start()},this)},this)},this),l.onStart.addOnce(function(){this.drawDragStarTrack(a,700,50)},this);let d=this.game.add.tween(a.handSprite);d.to({alpha:1},r,h,!1).onComplete.addOnce(function(){this.game.add.tween(a.handSprite).to({x:a.handSprite.x+n,y:a.handSprite.y+o},700,h,!0).onComplete.addOnce(function(){this.game.add.tween(a.handSprite).to({alpha:0},r,h,!0).onComplete.addOnce(function(){a.handSprite.x=t.x,a.handSprite.y=t.y,this.isTiping=!1,this.visible=!1,e&&e()},this)},this)},this),d.onStart.addOnce(function(){this.drawDragStarTrack(a,700,50)},this)}showRepeatSlide(t,i,e=1,s=0,a){let n=0,o={},h=function(){n++,a&&a(n),this.game.time.events.add(s,function(){o.forceStop||(-1==e||n<e)&&(o.group=this.showSlide(t,i,h))},this)}.bind(this);return o.group=this.showSlide(t,i,h),o.stop=function(t){o.forceStop=!0,t&&(o.group.visible=!1)},o}showTap(t,i){null==t.length&&(t=[t]),this.destroy(!0,!0);let e=this.game.add.group();this.addChild(e);for(let s=0;s<t.length;s++){const a=t[s],n=this.loadSprites(a,e);this.visible=!0,this.isTiping=!0,n.handSprite.alpha=0;const o=this.durationAlphaTween,h=this.easingLinear;this.game.add.tween(n.handSprite).to({alpha:1},o,h,!0).onComplete.addOnce(function(){this.game.time.events.add(500,function(){n.starSprite.visible=!0,n.starAnimation.play(15),n.starAnimation.onComplete.addOnce(function(){0===s&&(this.isTiping=!1,this.visible=!1,i&&i())},this)},this);this.game.add.tween(n.handSprite.scale).to({x:.9,y:.9},500,Phaser.Easing.Linear.None,!0,0,0,!0).onComplete.addOnce(function(){this.game.add.tween(n.handSprite).to({alpha:0},o,h,!0,100)},this)},this)}return e}showRepeatTaps(t,i=1,e=0,s){let a=0,n={},o=function(){a++,s&&s(a),this.game.time.events.add(e,function(){n.forceStop||(-1==i||a<i)&&(n.group=this.showTap(t,o))},this)}.bind(this);return n.group=this.showTap(t,o),n.stop=function(t){n.forceStop=!0,t&&(n.group.visible=!1)},n}getDistance(t,i){let e=Math.abs(t.x-i.x),s=Math.abs(t.y-i.y);return Math.sqrt(e*e+s*s)}showDrag(t,i,e,s=null){this.destroy(!0,!0),this.visible=!0,this.isTiping=!0;let a=this.game.add.group();this.addChild(a),null==i.length&&(i=[i]);const n=this.loadSprites(t,a),o=this.durationAlphaTween,h=this.easingLinear,r=Phaser.Easing.Cubic.Out;let l={x:[],y:[]},d=0;for(let e=0;e<i.length;e++)d+=this.getDistance(i[e],i[e-1]||t),l.x.push(i[e].x),l.y.push(i[e].y);const u=s||d/this.dragSpeed;return this.drawDragStarTrack(n,u),n.handSprite.alpha=0,this.game.add.tween(n.handSprite).to({alpha:1},o,h,!0).onComplete.addOnce(function(){this.game.add.tween(n.handSprite).to({x:l.x,y:l.y},u,r,!0).onComplete.addOnce(function(){this.game.add.tween(n.handSprite).to({alpha:0},o,h,!0).onComplete.addOnce(function(){this.visible=!1,this.isTiping=!1,e&&e()},this)},this)},this),a}showRepeatDrags(t,i,e=1,s=0,a,n=null){let o=0,h={},r=function(){o++,a&&a(o),this.game.time.events.add(s,function(){h.forceStop||(-1==e||o<e)&&(h.group=this.showDrag(t,i,r,n))},this)}.bind(this);return h.group=this.showDrag(t,i,r,n),h.stop=function(t){h.forceStop=!0,t&&(h.group.visible=!1)},h}drawDragStarTrackSprite(t,i){this.keyTrailStar1="gesturetiper_star_little_1",this.keyTrailStar2="gesturetiper_star_little_2",this.keyTrailStar3="gesturetiper_star_little_3";let e=this.jstar_rand(-1,1),s=this.jstar_rand(-1,1),a=this.jstar_rand(10,30),n=this.jstar_rand(10,30),o=i.x+e*a,h=i.y+s*n;const r=this.game.add.sprite(o,h,this.keyTrailStar1);r.anchor.set(.5),r.scale.setTo(1),t.add(r),r.animations.add(this.keyTrailStar1,this.getSpriteSheetsArray()).play(16).onComplete.add(function(){r.visible=!1,r.destroy()},this),this.game.add.tween(r).to({alpha:0},1e3,null,!0,200),o+=this.jstar_rand(10,20),h+=this.jstar_rand(10,20);const l=this.game.add.sprite(o,h,this.keyTrailStar2);l.anchor.set(.5),l.scale.setTo(1),t.add(l),l.animations.add(this.keyTrailStar2,this.getSpriteSheetsArray()).play(16).onComplete.add(function(){l.visible=!1,l.destroy()},this),this.game.add.tween(l).to({alpha:0},1e3,null,!0,200),e=this.jstar_rand(-1,1),s=this.jstar_rand(-1,1),a=this.jstar_rand(5,20),n=this.jstar_rand(5,20),o=i.x+e*a,h=i.y+s*n;const d=this.game.add.sprite(o,h,this.keyTrailStar3);d.anchor.set(.5),d.scale.setTo(1),t.add(d),d.animations.add(this.keyTrailStar3,this.getSpriteSheetsArray()).play(24).onComplete.add(function(){d.visible=!1,d.destroy()},this),this.game.add.tween(d).to({alpha:0},500,null,!0,500)}drawDragStarTrack(t,i,e){const s=t.trailStarGroup,a=t.handSprite;s.removeAll();const n=this.durationAlphaTween,o=Phaser.Easing.Linear.None,h=i||this.durationDragTween,r=e||20,l=this.game.time.create(!1);l.loop(r,function(){this.drawDragStarTrackSprite(s,a.position)},this),s.alpha=0,this.drawDragStarTrackSprite(s,a.position),this.game.add.tween(s).to({alpha:1},n,o,!0).onComplete.addOnce(function(){l.start(),this.game.time.events.add(this.getStarDuration(h),function(){l.stop()},this)},this)}jstar_rand(t,i){let e=Math.random();return e*=i-t,e+=t,e=Math.round(e)}getSpriteSheetsArray(){const t=this.game.math.between(0,15),i=[];for(let t=0;t<16;t++)i.unshift(t);if(15===t)return i;for(let e=14;e>t;e--)i.unshift(e);return i}getStarDuration(t){return t<2e3?t/10*7:t-800}setDragSpeed(t){this.dragSpeed=t}},FinishButtonsAssets=function(){return{finish_btn_finish:{type:"images",value:"finish_btn_finish.png"},whitebg_btn_finish:{type:"images",value:"whitebg_btn_finish.png"}}},FinishButtons=class extends Phaser.Group{constructor(t,i){super(t),this.setConfig(i),this.drawView()}init(){}setConfig(t){this.x=t.x||0,this.y=t.y||0,this.callback=t.callback||null,this.con=t.con||con,this.isBg=t.isBg||null}drawView(){this.finishButtons=this.game.add.button(0,0,"finish_btn_finish",this.callback,this.con),this.finishButtons.anchor.set(.5),this.isBg&&(this.finishBtnBg=this.game.add.sprite(0,0,"whitebg_btn_finish"),this.finishBtnBg.anchor.set(.5),this.finishBtnBg.scale.setTo(.95),this.addChild(this.finishBtnBg)),this.addButtonAnimation(this.finishButtons),this.addChild(this.finishButtons)}addButtonAnimation(t){t.onInputDown.add(function(){t.scale.setTo(.9,.9),this.game.add.tween(t.scale).to({x:1.1,y:1.1},100,Phaser.Easing.Linear.None,!0,0,0,!1)},this),t.onInputUp.add(function(){this.game.add.tween(t.scale).to({x:1,y:1},100,Phaser.Easing.Linear.None,!0,0,0,!1)},this)}setAlpha(){this.finishButtons.alpha=.5}resetAlpha(){this.finishButtons.alpha=1}setInputEnable(t){this.finishButtons.inputEnabled=t}continueButtonAnimation(){this.game.add.tween(this.finishButtons.scale).to({x:[1.1,1,.9,1],y:[1.1,1,.9,1]},800,"Linear",!0,0,-1)}};let PhotoButtonAssets=function(){return{photo_btn_camera:{type:"images",value:"photo_btn_camera.png"},photo_btn_audio:{type:"audio",value:"photo_btn_audio.mp3"}}},PhotoButton=class extends Phaser.Button{constructor(t,i){super(t,0,0,"photo_btn_camera",()=>{i.start&&i.start(),this.createImage(t),i.complete&&i.complete()}),this.anchor.set(.5)}createImage(t){let i=t.canvas.toDataURL("image/png");var e=document.createElement("a");e.href=i,e.download="DisneyImage",e.click()}base64Img2Blob(t){for(var i=t.split(";base64,"),e=i[0].split(":")[1],s=window.atob(i[1]),a=s.length,n=new Uint8Array(a),o=0;o<a;++o)n[o]=s.charCodeAt(o);return new Blob([n],{type:e})}};var DifficultPageAssets=function(){return{difficut_page_bg:{type:"images",value:"difficult_page_bg.jpg"},difficult_page_plate1:{type:"images",lang:!0,value:"difficult_page_plate1_01.png"},difficult_page_plate1_complete:{type:"images",lang:!0,value:"difficult_page_plate1_02.png"},difficult_page_plate2:{type:"images",lang:!0,value:"difficult_page_plate2_01.png"},difficult_page_plate2_complete:{type:"images",lang:!0,value:"difficult_page_plate2_02.png"},difficult_page_plate2_lock:{type:"images",lang:!0,value:"difficult_page_plate2_03.png"},difficult_page_plate3:{type:"images",lang:!0,value:"difficult_page_plate3_01.png"},difficult_page_plate3_complete:{type:"images",lang:!0,value:"difficult_page_plate3_02.png"},difficult_page_plate3_lock:{type:"images",lang:!0,value:"difficult_page_plate3_03.png"},select_lock_difficult_sound:{type:"audio",lang:!0,value:"select_lock_difficult_sound.mp3"}}},DifficultPage=class extends Phaser.Group{constructor(t){super(t),this.init(),this.create()}init(){this.offestX=30,this.difficultValue=this.game.difficultValue,this.difficultCallback=null,this.backgroundKey="difficut_page_bg",this.difficultKeyList=[{name:"easy",key:"difficult_page_plate1",completeKey:"difficult_page_plate1_complete"},{name:"middle",key:"difficult_page_plate2",completeKey:"difficult_page_plate2_complete",lockKey:"difficult_page_plate2_lock"},{name:"hard",key:"difficult_page_plate3",completeKey:"difficult_page_plate3_complete",lockKey:"difficult_page_plate3_lock"}],this.game.diffcultLength=3}create(){this.lockSound=this.game.add.audio("select_lock_difficult_sound"),this.backgroundSprite=this.game.add.image(0,0,this.backgroundKey),this.add(this.backgroundSprite),this.difficultGroup=this.game.add.group(),this.difficultKeyList.forEach(function(t,i){var e=null;i>this.difficultValue?(e=this.game.add.button(0,0,t.lockKey,this.selectLockDifficult,this)).isComplete=!1:i===this.difficultValue?(e=this.game.add.button(0,0,t.key,this.selectDifficult,this),this.scaleAnimations(e),e.isComplete=!1):(e=this.game.add.button(0,0,t.completeKey,this.selectDifficult,this)).isComplete=!0,e.anchor.set(.5);let s=1===i?0:0===i?-1:1;e.x=this.game.world.centerX+(this.offestX+e.width)*s,e.y=this.game.world.centerY,e.diffName=t.name,e.difficultValue=i,this.difficultGroup.addChild(e)}.bind(this)),window.GameControl.loadAssetsComplete()}selectDifficult(t){console.log(t.diffName),this.game.stageIndex=t.difficultValue,this.difficultCallback&&this.difficultCallback()}selectLockDifficult(t){console.log(t.diffName+" LOCK"),this.lockSound.isPlaying||this.lockSound.play()}setSelectDiffCallback(t){this.difficultCallback=t}scaleAnimations(t){this.game.add.tween(t.scale).to({x:[1.04,1,.96,1],y:[1.04,1,.96,1]},736,Phaser.Easing.Linear.None,!0,0,-1).yoyo=!0}};function DataManage(t){this.init(t)}window.Editor=window.Editor||{},Editor.Template=function(){function t(){}function e(){}function s(){}function a(){}function n(t){}return t.prototype.init=function(){this.input.maxPointers=1,this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0},t.prototype.preload=function(){Until.loadCommonAssets(LoadProgressBarAssets(),this.game)},t.prototype.create=function(){this.state.start("Preloader")},e.prototype.init=function(){this.game.assetData=Until.dataFromatAsstes(),this.processBarSize={w:446,h:52},this.processBarOffset={x:0,y:240}},e.prototype.preload=function(){this.loadProgressBar=new LoadProgressBar(this.game),this.LoadPalette(),Until.loadAssets(this.game.assetData,this.game),Until.loadCommonAssets(DifficultPageAssets(),this.game),Until.loadCommonAssets(GestureTiperAssets(),this.game),Until.loadCommonAssets(ReaxAudiosAssets(),this.game),Until.loadCommonAssets(FinishButtonsAssets(),this.game),Until.loadCommonAssets(PhotoButtonAssets(),this.game),Until.loadCommonAssets(SystemButtonsAssets(),this.game)},e.prototype.create=function(){this.loadProgressBar.loadComplete(function(){this.startGmae()}.bind(this))},e.prototype.startGmae=function(){this.state.start("DifficultScene")},e.prototype.LoadPalette=function(){Editor.Config.stages.forEach((t,i)=>{const e=t.game.paletteAssets,s="./assets/images/"+t.game.paletteTheme+"/",a=Editor.path+"/template/coloring/palette/"+t.game.paletteTheme+"/res/",n="production"===Editor.env?s:a;Object.keys(e).forEach(i=>{var s=e[i];const a=t.game.paletteTheme+"_"+i;s&&!this.cache.checkImageKey(a)&&this.load.image(a,n+s)})})},s.prototype.init=function(){},s.prototype.preload=function(){},s.prototype.create=function(){this.difficultPage=new DifficultPage(this.game),this.difficultPage.setSelectDiffCallback(this.selectDifficult.bind(this))},s.prototype.selectDifficult=function(){this.state.start("GamePlay")},a.prototype.init=function(){this.note=null,this.currentSelect=null,this.enbleInput=!1,this.canDraw=!1,this.animal=null,this.twoSelect=null,this.successTimer=null,this.paintTimer=null,this.color=null,this.paintCount=0,this.paintTime=0,this.moveTime=0,this.wrongTime=0,this.paintAllTime=0,this.helpTimer=null,this.stage=null,this.showPromptLoopTimer=null,this.isdraw=!1,this.scale=1,this.isBtnFinish=!1,this.firstAudio=!1,this.secondAudio=!1,this.gameStart=!1,"4/3"===this.game.Config.common.ratio&&(this.scale=1),this.stageIndex=this.getStageIndex(),this.currStage=this.getCurrentStage(this.stageIndex),this.setAssetsKeyWithStage(this.stageIndex),this.radius=this.currStage.game.radius,this.colors=this.currStage.game.colors,this.dyewareConfig=this.currStage.game.colorImage,this.paletteAssets=this.currStage.game.paletteAssets,this.locationX=this.currStage.game.locationX*this.scale,this.locationY=this.currStage.game.locationY*this.scale,this.showStartBrush=this.currStage.game.showStartBrush,this.isEraser=this.currStage.game.eraser,this.mixingBg=this.currStage.game.mixingBg,this.lineLimit=this.currStage.game.lineLimit,this.drawDefinition=this.currStage.game.drawDefinition,this.imagePositionX=this.currStage.game.imagePositionX,this.imagePositionY=this.currStage.game.imagePositionY,this.completeButtonX=this.currStage.game.completeButtonX,this.completeButtonY=this.currStage.game.completeButtonY,this.complateButtonShowTime=this.currStage.game.complateButtonShowTime,this.paletteTheme=this.currStage.game.paletteTheme,this.colorArea=this.currStage.game.colorArea,this.drawButton=this.currStage.game.drawButton,this.coloringBg=!!this.currStage.game.paletteAssets.drawColorsBg,this.drawTou=!!this.currStage.game.paletteAssets.drawTou,this.drawSpriteX=this.currStage.game.drawSprite.x,this.drawSpriteY=this.currStage.game.drawSprite.y,this.isClear=!1},a.prototype.getStageIndex=function(){return this.game.stageIndex?this.game.stageIndex:0},a.prototype.getCurrentStage=function(t){return this.game.Config.stages[t]},a.prototype.setAssetsKeyWithStage=function(t){this.backgroundKey=this.getAssetsKey("backgroundImage"),this.backImageKey=this.getAssetsKey("backImage"),this.frontImageKey=this.getAssetsKey("frontImage"),this.backgroundSoundKey=this.getAssetsKey("backgroundSound"),this.narrationKey=this.getAssetsKey("narration"),this.ambientMusicKey=this.getAssetsKey("ambientSound"),this.selectSoundKey=this.getAssetsKey("selectSound"),this.drawSoundKey=this.getAssetsKey("drawSound"),this.complateSoundKey=this.getAssetsKey("completeSound"),this.eraseSoundKey=this.getAssetsKey("eraseSound"),this.wrongSoundKey=this.getAssetsKey("wrongSound")},a.prototype.getAssetsKey=function(t){const i="stage-"+this.stageIndex+"_";return this.game.assetData[i+t].key},a.prototype.getPaletteImageKey=function(t){return this.currStage.game.paletteTheme+"_"+t},a.prototype.preload=function(){},a.prototype.create=function(){this.createAudios(),this.createMainView(),this.createButtons()},a.prototype.createMainView=function(){this.mainGroup=this.add.group(),this.backgroundImage=this.add.sprite(0,0,this.backgroundKey),this.mainGroup.add(this.backgroundImage)},a.prototype.createNoteView=function(){this.createDyewareButtons(),this.createAnimationArea(),this.mainGroup.add(this.areaGroup),this.mainGroup.add(this.palette),this.tracingGroup=this.add.group(),this.mainGroup.addChild(this.tracingGroup)},a.prototype.createAudios=function(){this.finishMusic=this.add.audio(this.complateSoundKey),this.selectSound=this.add.audio(this.selectSoundKey),this.paintAudio=this.add.audio(this.drawSoundKey),this.eraserSound=this.add.audio(this.eraseSoundKey),this.wrongSound=this.add.audio(this.wrongSoundKey),this.ambientSound=this.add.audio(this.ambientMusicKey),this.ambientSound.loop=!0,this.audioReas=new ReaxAudios(this.game)},a.prototype.createButtons=function(){this.photoBtn=new PhotoButton(this.game,{start:()=>{console.log("start")},complete:()=>{console.log("Complete")}}),this.mainGroup.addChild(this.photoBtn),this.photoBtn.position.set(1100,240),this.createFinishButtion(),this.gestureTiper=new GestureTiper(this.game),this.systemBtns=new SystemButtons(this.game,this.backgroundSoundKey,null,this.narrationKey,null),this.systemBtns.setHelpCallback(()=>this.helpButtonCallback()),this.systemBtns.setExitCallback(this.exitGame.bind(this)),this.startGame()},a.prototype.drawColor=function(t){var i=this.rgb(t);return i[0]=parseInt(i[0]).toString(16),1==i[0].length&&(i[0]="0"+i[0]),i[1]=parseInt(i[1]).toString(16),1==i[1].length&&(i[1]="0"+i[1]),i[2]=parseInt(i[2]).toString(16),1==i[2].length&&(i[2]="0"+i[2]),str="0x"+i.join(""),str},a.prototype.rgb=function(t){var i=t.indexOf("("),e=t.indexOf(")");return t.substring(i+1,e).split(",")},a.prototype.mixColor=function(t,e){var s=new Array(3);for(i=0;i<3;i++)s[i]=Math.round((parseInt(this.rgb(t)[i])+parseInt(this.rgb(e)[i]))/2);return"rgb("+parseInt(s[0]).toString()+","+parseInt(s[1]).toString()+","+parseInt(s[2]).toString()+")"},a.prototype.clearStart=function(){for(this.drawSprite.children[0].visible=!0,this.drawSprite.children[1].visible=!0,!this.selectSound.isPlaying&&this.selectSound.play(),this.isClear=!0,i=0;i<this.colors;i++)this.dyewareBtns[i].children[0].visible=!1,this.dyewareBtns[i].children[1].visible=!1},a.prototype.drawStart=function(){this.drawSprite.children[0].visible=!1,this.drawSprite.children[1].visible=!1,this.isClear=!1},a.prototype.createDyewareButtons=function(){var t=0,e=0;if(this.palette=this.add.image(0,0,this.getPaletteImageKey("palette")),this.palette.position.setTo(this.locationX,this.locationY),this.palette.scale.setTo(this.scale),this.dyewareBtns=[],this.dyewareGroup=this.add.group(),this.palette.addChild(this.dyewareGroup),this.isEraser){const t=this.add.sprite(0,0,this.getPaletteImageKey("eraser_glow"));t.anchor.setTo(.5),t.visible=!1;const i=this.add.image(0,0,this.getPaletteImageKey("selecting"));if(i.anchor.setTo(.5),i.position.setTo(0,-50),i.visible=!1,this.coloring=this.make.sprite(0,0,this.getPaletteImageKey("eraser")),this.drawSprite=this.add.button(this.drawSpriteX,this.drawSpriteY,this.coloring.key,this.clearStart,this),this.drawSprite.anchor.setTo(.5),this.drawSprite.position.setTo(this.drawSpriteX+this.drawSprite.width/2+10,this.drawSpriteY+this.drawSprite.height/2+10),this.addButtonAnimation(this.drawSprite),this.mixingBg&&this.coloringBg){const t=this.add.sprite(0,0,this.getPaletteImageKey("drawColorsBg"));t.position.setTo(this.drawButton[this.dyewareConfig.length-1].x,this.drawButton[this.dyewareConfig.length-1].y+120),this.drawSprite.position.setTo(this.drawButton[this.dyewareConfig.length-1].x+this.drawSprite.width/2+10,this.drawButton[this.dyewareConfig.length-1].y+this.drawSprite.height/2+120+10),this.palette.addChild(t)}this.palette.addChild(this.drawSprite),this.drawSprite.addChild(t),this.drawSprite.addChild(i)}for(i=0;i<this.dyewareConfig.length;i++){const a=this.add.sprite(0,0,this.getPaletteImageKey("drawColorsAim"));a.anchor.setTo(.5),a.visible=!1;const n=this.add.image(0,0,this.getPaletteImageKey("selecting"));n.anchor.setTo(.5),n.position.setTo(0,-50),n.visible=!1,0==i&&(a.visible=!0,n.visible=!0);t=this.drawButton[i].x,e=this.drawButton[i].y;var s=this.make.sprite(0,0,this.getPaletteImageKey("drawColors"));if(this.coloringBg){const o=this.add.sprite(0,0,s.key);o.tint=this.drawColor(this.dyewareConfig[i].color),o.anchor.setTo(.5),o.color=this.dyewareConfig[i].color,o.select=a,o.selesting=n;const h=this.add.button(t,e,this.getPaletteImageKey("drawColorsBg"),function(){this.select(o)},this);if(h.position.setTo(t+h.width/2,e+h.height/2),h.anchor.setTo(.5),h.addChild(o),o.index=i,o.addChild(a),o.addChild(n),this.drawTou){const t=this.add.sprite(0,0,this.getPaletteImageKey("drawTou"));t.anchor.setTo(.5),h.addChild(t)}this.addButtonAnimation(h),this.dyewareBtns.push(o),this.dyewareGroup.add(h),0==i&&(this.tapX=this.locationX+h.position.x,this.tapY=this.locationY+h.position.y)}else{const o=this.add.button(t,e,s.key,this.select,this);if(o.tint=this.drawColor(this.dyewareConfig[i].color),o.position.setTo(t+o.width/2,e+o.height/2),o.anchor.setTo(.5),o.index=i,o.color=this.dyewareConfig[i].color,o.addChild(a),o.addChild(n),this.drawTou){const t=this.add.sprite(0,0,this.getPaletteImageKey("drawTou"));t.anchor.setTo(.5),o.addChild(t)}o.select=a,o.selesting=n,this.addButtonAnimation(o),this.dyewareBtns.push(o),this.dyewareGroup.add(o),0==i&&(this.tapX=this.locationX+o.position.x,this.tapY=this.locationY+o.position.y)}}},a.prototype.select=function(t){if(!this.enbleInput)return;this.hideTouchHelpPrompt(),this.isClear&&this.isEraser&&this.drawStart(),this.gameStart?!this.selectSound.isPlaying&&this.selectSound.play():this.gameStart=!0,this.color=t.color,null!==this.currentSelect&&(this.dyewareBtns[this.currentSelect].children[0].visible=!1,this.dyewareBtns[this.currentSelect].children[1].visible=!1),this.currentSelect=t.index;const i=this.dyewareBtns[t.index];i.children[0].visible=!0,i.children[1].visible=!0},a.prototype.addButtonAnimation=function(t){t.onInputDown.add(function(){this.enbleInput&&(t.scale.setTo(.7,.7),this.game.add.tween(t.scale).to({x:.9,y:.9},100,Phaser.Easing.Linear.None,!0,0,0,!1))},this),t.onInputUp.add(function(){this.enbleInput&&this.game.add.tween(t.scale).to({x:.8,y:.8},100,Phaser.Easing.Linear.None,!0,0,0,!1)},this),this.add.tween(t.scale).to({x:.8,y:.8},1e3,Phaser.Easing.Linear.Out,!0,0,0,!1)},a.prototype.createAnimationArea=function(){const t=this.colorArea;this.note=this.add.sprite(0,0,this.backImageKey),this.animationArea=this.add.bitmapData(t.width,t.height),this.animationImage=this.animationArea.addToWorld(t.x,t.y),this.animation=this.add.sprite(0,0,this.frontImageKey),this.animation.position.setTo((this.note.width-this.animation.width)/2,(this.note.height-this.animation.height)/2),this.animation.inputEnabled=!0,this.systemBtns.existMoveCallback(this.paint,this)||this.game.input.addMoveCallback(this.paint,this),this.animation.events.onInputDown.add(function(t,i){this.canDraw=!0,this.pointerDown=i,this.initX=i.x-this.imagePositionX-this.colorArea.x,this.initY=i.y-this.imagePositionY-this.colorArea.y,this.isClear?this.animationArea.blendDestinationOut():this.animationArea.blendSourceOver(),this.color&&this.animationArea.circle(this.initX,this.initY,this.radius,this.color)},this),this.animation.events.onInputUp.add(function(){this.paintAllTime+=this.paintTime,this.moveTime=0,this.canDraw=!1,this.wrongTime&&(clearTimeout(this.wrongTime),this.wrongTime=null)},this),this.frontBitmapData=this.make.bitmapData(this.animation.width,this.animation.height),this.frontBitmapData.draw(this.frontImageKey),this.frontBitmapData.update(),this.animation.events.onDestroy.addOnce(function(){this.frontBitmapData.destroy(),this.frontBitmapData=null},this),this.areaGroup=this.add.group(),this.areaGroup.add(this.note),this.areaGroup.add(this.animationImage),this.areaGroup.add(this.animation),this.areaGroup.scale.setTo(this.scale),this.areaGroup.position.setTo(this.imagePositionX,this.imagePositionY),this.stage="painter",this.loopShowTouchHelpPrompt()},a.prototype.update=function(){if(-1!=this.pointerDown&&this.pointerDown&&this.canDraw&&(this.paintCount=this.paintAllTime+this.paintTime,this.paintCount>.15*this.complateButtonShowTime&&!this.firstAudio&&(this.firstAudio=!0,this.audioReas.playAudioGoodJob()),this.paintCount>.3*this.complateButtonShowTime&&!this.secondAudio&&(this.secondAudio=!0,this.audioReas.playAudioWellDone()),this.paintTime=this.moveTime/1e3,!this.isBtnFinish))if((this.paintAllTime+this.paintTime)*(360/this.complateButtonShowTime)-90<=270){if(0===this.paintAllTime&&0===this.paintTime)return;this.graphics.clear(),this.graphics.beginFill(2105376),this.graphics.arc(this.btnX,this.btnY,this.finishBtns.width/2-13,-90*Math.PI/180,((this.paintAllTime+this.paintTime)*(360/this.complateButtonShowTime)-90)*Math.PI/180,!0),this.graphics.endFill()}else this.finishBtns.resetAlpha(),this.enableFinishButton(),this.graphics.destroy(),this.finishMusic.play(),this.finishBtns.continueButtonAnimation(this.finishBtns)},a.prototype.paint=function(t,i,e){if(this.enbleInput&&this.color&&this.canDraw&&t.isDown){this.hideTouchHelpPrompt(),this.startTouchHelpPromptListener();const s=i-this.imagePositionX-this.colorArea.x,a=e-this.imagePositionY-this.colorArea.y;this.animationArea.circle(s,a,this.radius,this.color),this.animationArea.line(this.initX,this.initY,s,a,this.color,2*this.radius),this.initX=s,this.initY=a,this.inPaintArea(t)?(this.isClear?(this.paintAudio.isPlaying&&this.paintAudio.stop(),this.eraserSound&&!this.eraserSound.isPlaying&&this.eraserSound.play()):(this.moveTime+=18,this.eraserSound.isPlaying&&this.eraserSound.stop(),this.paintAudio&&!this.paintAudio.isPlaying&&this.paintAudio.play()),this.showStartBrush&&this.gestureTiper.drawDragStarTrackSprite(this.tracingGroup,{x:i,y:e}),this.wrongTime&&(this.wrongSound.stop(),clearTimeout(this.wrongTime),this.wrongTime=null)):this.wrongTime||(this.wrongTime=setTimeout(()=>{this.wrongSound&&!this.wrongSound.isPlaying&&this.wrongSound.play(),this.wrongTime=null},1e3))}},a.prototype.inPaintArea=function(t){let i=this.imagePositionX+this.colorArea.x,e=this.imagePositionY+this.colorArea.y;const s=this.colorArea.width,a=this.colorArea.height,n=t.x>i&&t.x<i+s&&t.y>e&&t.y<e+a;i=parseInt(t.x-this.imagePositionX-this.animation.x),e=parseInt(t.y-this.imagePositionY-this.animation.y);let o=this.frontBitmapData.getPixelRGB(i,e).a;return o=Math.floor(o/255*100)/100,n&&o<=this.drawDefinition},a.prototype.areaAnimations=function(){this.areaGroup.scale.setTo(this.scale),this.areaGroup.position.setTo(this.imagePositionX,this.imagePositionY),this.stage="painter",this.loopShowTouchHelpPrompt()},a.prototype.startGame=function(){this.systemBtns.enableExitButton(),this.enbleInput=!0,this.createNoteView(),this.ambientSound.play(),this.select(this.dyewareBtns[0])},a.prototype.exitGame=function(){this.enbleInput&&(this.color=null,this.ambientSound.stop(),this.stopTouchHelpPromptListener(),this.hideTouchHelpPrompt(),this.enbleInput=!1,this.animation.inputEnabled=!1,this.game.input.deleteMoveCallback(this.paint,this))},a.prototype.finishGame=function(){this.enbleInput&&(this.color=null,this.ambientSound.stop(),this.stopTouchHelpPromptListener(),this.hideTouchHelpPrompt(),this.enbleInput=!1,this.animation.inputEnabled=!1,this.game.input.deleteMoveCallback(this.paint,this),this.showGameSuccess())},a.prototype.createFinishButtion=function(){this.finishBtns=new FinishButtons(this.game,{x:0,y:0,callback:this.finish,con:this,isBg:!0}),this.btnX=(this.completeButtonX+this.finishBtns.width/2)*this.scale,this.btnY=(this.completeButtonY+this.finishBtns.height/2)*this.scale,this.finishBtns.position.setTo(this.btnX,this.btnY),this.finishBtns.setInputEnable(!1),this.finishBtns.setAlpha(),this.graphics=this.add.graphics(0,0),this.graphics.alpha=.5,this.graphics.beginFill(2105376),this.graphics.arc(this.btnX,this.btnY,this.finishBtns.width/2-13,323,360*Math.PI/180,!0),this.graphics.endFill()},a.prototype.finish=function(){this.finishBtns.inputEnabled=!1,this.game.add.tween(this.finishBtns.scale).to({x:0,y:0},250,Phaser.Easing.Linear.None,!0,0,0,!1),this.graphics&&this.graphics.destroy(),this.finishGame()},a.prototype.addButtonAnimation=function(t){t.onInputDown.add(function(){t.scale.setTo(.9,.9),this.game.add.tween(t.scale).to({x:1.1,y:1.1},100,Phaser.Easing.Linear.None,!0,0,0,!1)},this),t.onInputUp.add(function(){this.game.add.tween(t.scale).to({x:1,y:1},100,Phaser.Easing.Linear.None,!0,0,0,!1)},this)},a.prototype.showGameSuccess=function(){this.successTimer&&clearTimeout(this.successTimer),this.paintCount>this.complateButtonShowTime&&(this.paintCount=this.complateButtonShowTime),setTimeout(()=>{this.systemBtns.showStarBurst(this.world.centerX,this.world.centerY,function(){this.systemBtns.showEndingPage("complete",{time:this.paintCount})}.bind(this))},1e3)},a.prototype.showTouchHelpPrompt=function(){if(this.helpTouchSign)return;this.helpTouchSign=!0;const t={x:this.tapX,y:this.tapY};this.gestureTiper.showTap(t,()=>{this.gestureTiper.showDrag({x:700,y:300},{x:900,y:300},()=>{this.helpTouchSign=!1})})},a.prototype.loopShowTouchHelpPrompt=function(){if(!this.showPromptLoopTimer){this.showPromptLoopTimer=this.time.create(!1);const t=2500;this.showPromptLoopTimer.loop(t,function(){this.touchHelpHide?this.showPromptLoopTimer.stop():this.showTouchHelpPrompt()},this),this.showPromptLoopTimer.start(),this.showTouchHelpPrompt()}},a.prototype.hideTouchHelpPrompt=function(){this.touchHelpHide||(this.touchHelpHide=!0)},a.prototype.startTouchHelpPromptListener=function(){this.helpTimer||(this.helpTimer=this.time.create(!1),this.helpTimer.loop(7e3,this.showTouchHelpPrompt,this)),this.stopTouchHelpPromptListener(),this.helpTimer.start()},a.prototype.stopTouchHelpPromptListener=function(){this.helpTimer&&this.helpTimer.running&&this.helpTimer.stop(!1)},a.prototype.helpButtonCallback=function(){"painter"===this.stage&&this.showTouchHelpPrompt()},a.prototype.enableFinishButton=function(){this.finishBtns.setInputEnable(!0),this.isBtnFinish=!0},a.prototype.shutdown=function(){this.areaGroup&&this.areaGroup.destroy(!0),this.areaGroup=null,this.animation&&this.animation.destroy(),this.animation=null,this.animationArea&&this.animationArea.destroy(),this.animationArea=null,this.systemBtns&&(this.systemBtns.existMoveCallback(this.paint,this)||this.game.input.deleteMoveCallback(this.paint,this),this.systemBtns.destroy(!0),this.systemBtns=null)},n.prototype.initGame=function(i){var n=Editor.Config.common.ratio.split("/"),o=720*n[0]/n[1];this.game=new Phaser.Game(o,720,Phaser.CANVAS,"",null,!0),this.game.Config=Editor.Config,this.game.state.add("Boot",t),this.game.state.add("Preloader",e),this.game.state.add("DifficultScene",s),this.game.state.add("GamePlay",a),this.addCommon()},n.prototype.addCommon=function(){if("production"!==Editor.env){var t=Until.getCommonThemeJs(),i=[t+"/GameControl.js",t+"/LoadProgressBar.js",t+"/GestureTiper.js",t+"/ReaxAudios.js",t+"/SystemButtons.js",t+"/DifficultPage.js",t+"/FinishButtons.js",t+"/PhotoButton.js",t+"/DataManage.js"];Until.loadCommon(i,function(){this.startGame()}.bind(this))}else this.startGame()},n.prototype.startGame=function(){this.game.state.start("Boot")},n}(),DataManage.prototype.init=function(t){this.deviceModel=t.deviceModel,this.activityId=t.activityId,this.difficult=t.difficult,this.btnRestartNum=0,this.dataList=[],this.currData=this.initData(),this.dataList.push(this.currData)},DataManage.prototype.initData=function(){var t={dataTimeStart:0,dataTimeEnd:0,timeTotal:0,effectiveActionNum:0,faultActionNum:0,btnHelpNum:0,btnHelpFirstTime:0,btnQuitTime:0,gameFinish:0,activityScore:0,difficult:0};return t},DataManage.prototype.effectiveAction=function(){this.currData.effectiveActionNum+=1},DataManage.prototype.faultAction=function(){this.currData.faultActionNum+=1},DataManage.prototype.btnHelpAction=function(){this.currData.btnHelpNum+=1,this.currData.btnHelpFirstTime||(this.currData.currData=Date.now())},DataManage.prototype.btnBgmusicAction=function(){this.currData.btnBgmusicAction+=1,this.currData.btnBgmusicTime=Date.now()},DataManage.prototype.btnQuitAction=function(){this.currData.btnQuitTime=Date.now()},DataManage.prototype.gameFinishStatus=function(t){this.currData.gameFinish=t},DataManage.prototype.resetData=function(){this.currData=null,this.currData=this.initData(),this.dataList.push(this.currData)},DataManage.prototype.activityScore=function(t){const i=this.getActivityType(window.Editor.Config.common.template),e=this.dealActivityScore(i,t);return this.currData.activityScore=e,e},DataManage.prototype.dataTimeStart=function(){this.currData.dataTimeStart=Date.now()},DataManage.prototype.dataTimeEnd=function(t,i){this.currData.dataTimeEnd=Date.now(),this.currData.timeTotal=this.currData.dataTimeEnd-this.currData.dataTimeStart;let e=0;"skip"!==t&&(e=this.activityScore(i));const s=this.getFinishStatusValue(t,e);this.gameFinishStatus(s)},DataManage.prototype.setGameDifficult=function(t){this.currData.difficult=t+1,this.currData.difficult>this.difficult&&(this.difficult=this.currData.difficult)},DataManage.prototype.setUnloackDifficult=function(t){this.difficult=t+1},DataManage.prototype.getUserData=function(){return{activityId:this.activityId,difficult:this.difficult,gameInfo:this.dataList}},DataManage.prototype.dealActivityScore=function(t,i){switch(t){case"action":var e=this.currData.effectiveActionNum/(this.currData.faultActionNum+this.currData.effectiveActionNum)*100;return Math.round(e);case"time":return i.time>10?100:Math.round(10*i.time);case"target":e=i.clickNum/i.targetNum*100;return Math.round(e)}},DataManage.prototype.getActivityType=function(t){switch(t){case"puzzle":case"runner":case"card_matching":case"search_find":case"follow_squeence":case"tracing":case"tapping_normal":return"action";case"coloring":return"time";case"tapping":case"tapping_quick":case"tapping_flying":case"balancing":return"target"}},DataManage.prototype.getFinishStatusValue=function(t,i){switch(t){case"complete":return i>=80?1:i>=50?2:3;case"uncomplete":return 3;case"skip":return 4;default:return 0}},function(){function t(){(new Editor.Template).initGame()}window.addEventListener("load",function(){Until.getJSON("./config.json",function(i){!function(i){window.Editor.Config=i,document.title=Editor.Config.title,Editor.Template?t():Until.addScript(Until.getTemplate(),function(){t()})}(i)})})}(),window.Until={getTemplate:function(){var t=Editor.Config.common.template,i=Editor.Config.common.style;return t=Editor.path+"/template/"+t+"/js/"+i.toLowerCase()+".js"},addScript:function(t,i){var e=document.createElement("script");e.type="text/javascript",e.src=t,document.body.appendChild(e),e.onload=function(){i&&i()}},loadCommon:function(t,i){if(0===t.length)i();else{var e=t.shift();Until.addScript(e,function(){Until.loadCommon(t,i)})}},loadAssets:function(t,i){Object.keys(t).forEach(function(e){var s=t[e];if(""!==s.value&&""!==s.key){var a=Until.getGameAssetsUrl(s);switch(s.type){case"images":i.cache.checkImageKey(s.key)||i.load.image(s.key,a+s.value);break;case"atlas":i.cache.checkJSONKey(s.key)||i.load.atlasJSONArray(s.key,a+s.value,a+s.json);break;case"audio":i.cache.checkSoundKey(s.key)||i.load.audio(s.key,a+s.value)}}})},getAssetsFileName:function(t){var i=t.split("/");return i[i.length-1]},loadCommonAssets:function(t,i){Object.keys(t).forEach(function(e){var s=t[e];if(""!==s.value){var a=Until.getCommonTheme(s);switch(s.type){case"images":i.load.image(e,a+s.value);break;case"atlas":i.load.atlasJSONArray(e,a+s.value,a+s.json);break;case"audio":i.load.audio(e,a+s.value)}}})},getGameAssetsUrl:function(t){if(t.value.indexOf("/")>-1)return".";if("production"!==Editor.env){if("images"===t.type){var i=Editor.path+"/template/"+Editor.Config.common.template+"/theme/";return t.lang&&(i+=Editor.Config.common.language+"/"),i}var e=Editor.path+"/template/"+Editor.Config.common.template+"/"+t.type+"/";return t.lang&&(e+=Editor.Config.common.language+"/"),e}return"./assets/"+t.type+"/"},getCommonTheme:function(t){if("production"===Editor.env)return"./assets/"+t.type+"/";if(t.path)return Editor.path+t.path+t.type+"/";var i=Editor.path+"/common/theme/"+Editor.Config.common.theme+"/"+t.type+"/";return t.lang&&(i+=Editor.Config.common.language+"/"),i},getCommonThemeJs:function(){return"production"===Editor.env?"./":Editor.path+"/common/js"},dataFromatAsstes:function(){var t={};return Editor.Config.stages.forEach(function(i,e){var s=i.assets;s&&Object.keys(s).forEach(function(i){var a=s[i];Array.isArray(a)?a.forEach(function(s,a){t["stage-"+e+"_"+i+a]=s,s.key=Until.getAssetsFileName(s.value)}):(t["stage-"+e+"_"+i]=a,a.key=Until.getAssetsFileName(a.value))})}),t},isUndefined:function(t){return void 0===t},getRandomValue:function(t){return 170*t.rnd.normal()},getJSON:function(t,i){var e;(e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onreadystatechange=function(){if(4==e.readyState&&200==e.status){var t=e.responseText;i(JSON.parse(t))}},e.open("GET",t,!0),e.send()}};