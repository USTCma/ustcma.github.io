window.Editor={env:"production"},window.GameControl={activityId:null,difficult:null,params:null,exitGame(t){console.log("exitActivity"),this.isExist()&&"function"==typeof JSBridge.exitActivity&&JSBridge.exitActivity(t)},isExist:()=>"undefined"!=typeof JSBridge,getProfileInfo(t,e){console.log("getProfileInfo"),this.isExist()&&"function"==typeof JSBridge.getProfileInfo?JSBridge.getProfileInfo(t,t=>{"getProfileInfo:ok"===t.errMsg?e(t.data.profile):(console.log(t.errMsg),e(null))},()=>{e(null)}):e(null)},indicateActivityReady(){console.log("indicateActivityReady"),this.isExist()&&"function"==typeof JSBridge.indicateActivityReady&&JSBridge.indicateActivityReady()},getActivityId(){if(null===this.activityId){this.activityId="";const t=this.getUrlParams();void 0!==t.activityId&&(this.activityId=t.activityId)}return this.activityId},getUrlParams(){if(!this.params){const t={},e=document.location.search;if(""!==e){const i=e.substring(1).split("&");for(const e in i){const s=i[e].split("=");s.length>1&&(t[s[0]]=s[1])}}this.params=t,console.log("url params",this.params)}return this.params},openIframe(t){if(t){const e=document.createElement("iframe");e.id="iframeView",e.src=t,e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.width="100%",e.style.height="100%",document.body.appendChild(e),e.focus(),window.closeIframe=this.closeIframe}},closeIframe(){const t=document.querySelector("#iframeView");t&&(t.src="about:blank",document.body.removeChild(t)),window.focus()},loadAssetsComplete(){console.log("loadAssetsComplete"),this.isExist()&&"function"==typeof JSBridge.loadAssetsComplete&&JSBridge.loadAssetsComplete()},uploadUserData(t){console.log(JSON.stringify(t));var e=window.Editor.Config.common.log;console.log("log is "+e),this.isExist()&&"function"==typeof JSBridge.uploadUserData&&window.Editor.Config.common.log&&(console.log("uploadUserData"),JSBridge.uploadUserData(t))},setActivityControl(t){console.log("setActivityControl",t),this.isExist()&&"function"==typeof JSBridge.setActivityControl&&JSBridge.setActivityControl(t)},getActivityDifficult(){if(null===this.difficult){this.difficult=1;const t=this.getUrlParams();void 0!==t.difficult&&(this.difficult=t.difficult)}return console.log("user current difficult "+this.difficult),this.difficult}};var SystemButtonsAssets=function(){return{system_btn_help:{type:"images",value:"system_btn_help.png"},system_btn_sound_off:{type:"images",value:"system_btn_sound_off.png"},system_btn_sound_on:{type:"images",value:"system_btn_sound_on.png"},system_btn_profile:{type:"images",value:"system_btn_profile.png"},system_btn_exit:{type:"images",value:"system_btn_exit.png"},system_btn_exit_disable:{type:"images",value:"system_btn_exit_disable.png"},success_btn_continue:{type:"images",value:"success_btn_continue.png"},ending_char_fail:{type:"images",value:"ending_char_fail.png"},ending_check_complete:{type:"images",value:"ending_check_complete.png"},ending_check_lock:{type:"images",value:"ending_check_lock.png"},ending_bg_white:{type:"images",value:"ending_bg_white.png"},ending_char_complete:{type:"images",value:"ending_char_complete.png"},ending_char_bar:{type:"images",value:"ending_char_bar.png"},ending_frame:{type:"images",value:"ending_frame.png"},ending_btn_tryagain:{type:"images",lang:!0,value:"ending_btn_tryagain.png"},ending_btn_difficult_1:{type:"images",lang:!0,value:"ending_btn_normal.png"},ending_btn_difficult_2:{type:"images",lang:!0,value:"ending_btn_hard.png"},ending_text_allpass:{type:"images",lang:!0,value:"ending_text_allpass.png"},ending_animation_star:{type:"atlas",value:"ending_animation_star.png",json:"ending_animation_star.json"},ending_sound_complete:{type:"audio",lang:!0,value:"ending_sound_complete.mp3"},ending_sound_tryagain:{type:"audio",lang:!0,value:"ending_sound_tryagain.mp3"},ending_sound_allpass:{type:"audio",value:"ending_sound_allpass.mp3"},ending_sound_char:{type:"audio",value:"ending_sound_char.mp3"},ending_sound_continue:{type:"audio",value:"ending_sound_continue.mp3"},ending_sound_unlock:{type:"audio",value:"ending_sound_unlock.mp3"},ending_sound_white:{type:"audio",value:"ending_sound_white.mp3"},ending_sound_end:{type:"audio",value:"ending_sound_end.mp3"},star_burst_big:{type:"atlas",value:"star_burst_big.png",json:"star_burst_big.json"}}},SystemButtons=class extends Phaser.Group{constructor(t,e,i,s,a){super(t),this.init(e,i,s,a),this.sound(),this.createButtons(),this.createTutorialPage(),this.drawChildGroup(),this.drawEndingView(),this.exitButtonEnabled(),window.dataManage.dataTimeStart(),window.dataManage.setGameDifficult(this.game.stageIndex)}init(t,e,i,s){this.complete=!0,this.backgroundMusic=this.getSound(t),this.introMusic=this.getSound(e),this.helpMusic=this.getSound(i),this.tutorialImage=this.getImage(s),this.exitCallback=null,this.muteCallback=null,this.helpCallback=null,this.refreshCallback=null,this.profileUrl=null,this.profileCallback=null,this.tutorialEndCallback=null,this.canExit=!1,this.enableTimer=null,this.enableTimerStatus=!1,this.helpCountdownTimer=null,this.exitAnimationTimer=null,this.sparkleTouchSprites=null,this._defaultConfig={mute:{x:1220,y:60,key:"system_btn_sound_on",muteKey:"system_btn_sound_off"},exit:{x:60,y:60,key:"system_btn_exit",disableKey:"system_btn_exit_disable"},help:{x:60,y:660,key:"system_btn_help",intro:"introdcution",playIntro:"help"},profile:{x:60,y:60,key:"system_btn_profile"}}}sound(){if(this.game.isRestart)return;this.backgroundMusic&&!1===this.backgroundMusic.loop&&(this.backgroundMusic.loop=!0),this.introMusic&&this.helpMusic?(this.game.sound.setDecodedCallback([this.introMusic,this.helpMusic],function(){!this.introMusic.isPlaying&&this.introMusic.play()},this),this.introMusic&&this.introMusic.onStop.add(function(){!this.helpMusic.isPlaying&&this.helpMusic.play()},this)):(!this.backgroundMusic.isPlaying&&this.backgroundMusic.play(),this.helpMusic&&this.helpMusic.play());const t=this.getSound("select_lock_difficult_sound");t&&t.isPlaying&&t.fadeOut(500)}createTutorialPage(){!this.game.isRestart&&this.tutorialImage&&(this.tutorialPageMask=this.game.add.graphics(0,0),this.tutorialPageMask.clear(),this.tutorialPageMask.beginFill(0,.8),this.tutorialPageMask.drawRect(0,0,1280,720),this.tutorialPageMask.endFill(),this.add(this.tutorialPageMask),this.tutorialPageMask.inputEnabled=!0,this.tutorialImage&&this.tutorialPageMask.addChild(this.tutorialImage),this.helpMusic&&this.helpMusic.onStop.addOnce(this.removeTutorialPage,this))}createButtons(){let t,e;t=this._defaultConfig.mute,e=this.backgroundMusic&&this.backgroundMusic.paused?t.muteKey:t.key,this.buttonOffest=60,this.muteBtn=this.game.add.button(this.game.width-this.buttonOffest,this.buttonOffest,e,this.muteManage,this),this.muteBtn.anchor.setTo(.5),this.addButtonAnimation(this.muteBtn),this.add(this.muteBtn),t=this._defaultConfig.exit,this.exitBtn=this.game.add.button(this.buttonOffest,this.buttonOffest,t.disableKey,this.exitManage,this),this.exitBtn.anchor.setTo(.5),this.add(this.exitBtn),t=this._defaultConfig.help,this.helpBtn=this.game.add.button(this.buttonOffest,this.game.height-this.buttonOffest,t.key,this.playHelp,this),this.helpBtn.anchor.setTo(.5),this.addButtonAnimation(this.helpBtn),this.add(this.helpBtn),this.helpButtonCountdowmTime(),this.game.Config.common.showProfile&&this.createProfileButton()}createProfileButton(t){const e=this._defaultConfig.profile;this.profileBtn=this.game.add.button(this.buttonOffest,this.buttonOffest,e.key,this.showProfilePage,this),this.profileBtn.visible=!0,this.profileBtn.anchor.setTo(.5),this.addButtonAnimation(this.profileBtn),this.add(this.profileBtn),GameControl.getProfileInfo(t,t=>{t&&(this.profileUrl=t)})}addButtonAnimation(t){t.onInputDown.add(function(){t.scale.setTo(.9,.9),this.game.add.tween(t.scale).to({x:1.1,y:1.1},100,Phaser.Easing.Linear.None,!0,0,0,!1)},this),t.onInputUp.add(function(){this.game.add.tween(t.scale).to({x:1,y:1},100,Phaser.Easing.Linear.None,!0,0,0,!1)},this)}exitManage(){this.canExit&&this.exitGame()}exitGame(){this.exitCallback&&this.exitCallback(),this.hideExitButtonTouchPrompt(),this.showEndingPage("skip"),window.dataManage.btnQuitAction()}muteManage(){this.backgroundMusic&&(this.backgroundMusic.paused?(this.backgroundMusic.resume(),this.muteBtn.loadTexture(this._defaultConfig.mute.key)):(this.backgroundMusic.pause(),this.muteBtn.loadTexture(this._defaultConfig.mute.muteKey))),this.muteCallback&&this.muteCallback()}playHelp(){null===this.introMusic?this.helpMusic&&!this.helpMusic.isPlaying&&this.helpMusic.play():!this.helpMusic||this.introMusic.isPlaying||this.helpMusic.isPlaying||this.helpMusic.play(),!0!==this.game.helpBtnTouch&&(this.game.helpBtnTouch=!0),this.hideHelpButtonTouchPrompt(),this.helpCallback&&this.helpCallback(),window.dataManage.btnHelpAction()}playHelpAudio(){this.helpMusic&&!this.helpMusic.isPlaying&&this.helpMusic.play()}showProfilePage(){this.profileCallback&&this.profileCallback()}getSoundByKey(t){let e=0;const i=this.game.sound._sounds,s=i.length;for(;e<s;e++)if(i[e].key===t)return i[e];return null}getMuteButton(){return this.muteBtn}getHelpButton(){return this.helpBtn}getExitButton(){return this.exitBtn}getProfileButton(){return this.profileBtn}setMuteCallback(t){this.muteCallback=t}setExitCallback(t){this.exitCallback=t}setHelpCallback(t){this.helpCallback=t}setProfileCallback(t){this.profileCallback=t}setTutorialEndCallback(t){this.tutorialEndCallback=t,this.game.isRestart&&(this.tutorialEndCallback(),this.helpButtonCountdowmTime())}exitButtonEnabled(){const t=1e3*this.game.Config.common.exitTotalTime;setTimeout(()=>{this.canExit=!0,this.exitBtn.loadTexture(this._defaultConfig.exit.key),this.exitButtonEnableInputAnimation(),this.addButtonAnimation(this.exitBtn)},t)}setUserInput(){}enableExitButton(t,e){}updateExitButtonStatus(){this.userInput?(this.userInput=!1,this.grandTotalTime+=this.exitInterval,this.grandTotalTime>=this.exitTotalTime&&(this.enableTimer.stop(),this.canExit=!0,this.exitBtn.loadTexture(this._defaultConfig.exit.key),this.exitButtonEnableInputAnimation(),this.addButtonAnimation(this.exitBtn),this.exitDeleteImputEventListener())):this.grandTotalTime=0}updateDisableExitStatus(t){let e;e=this.grandTotalTime>=this.exitTotalTime?1:t?(this.grandTotalTime+this.exitInterval)/this.exitTotalTime:0,this.game.add.tween(this.exitImage).to({alpha:e},this.exitInterval,Phaser.Easing.Linear.None,!0,0,0,!1)}removeTutorialPage(){this.tutorialPageMask.inputEnabled=!1,!this.backgroundMusic.isPlaying&&this.backgroundMusic.play(),this.game.add.tween(this.tutorialPageMask).to({alpha:0},1e3,Phaser.Easing.Linear.None,!0,0,0,!1).onComplete.add(function(){this.tutorialPageMask.destroy(),this.tutorialEndCallback&&this.tutorialEndCallback()},this)}getSound(t){if("string"==typeof t){let e=this.getSoundByKey(t);return e||(e=this.game.add.audio(t)),e}return"object"!=typeof t||Array.isArray(t)?null:t}getImage(t){if("string"==typeof t){const e=this.game.make.image(this.game.world.centerX,this.game.world.centerY,t);return e.anchor.setTo(.5),e}return"object"!=typeof t||Array.isArray(t)?null:t}exitAddInputEventListener(){this.game.input.onDown.has(this.setUserInput,this)||this.game.input.onDown.add(this.setUserInput,this),this.game.input.onUp.has(this.setUserInput,this)||this.game.input.onUp.add(this.setUserInput,this),this.existMoveCallback(this.setMoveUserInput,this)||this.game.input.addMoveCallback(this.setMoveUserInput,this)}exitDeleteImputEventListener(){this.game.input.onDown.has(this.setUserInput,this)&&this.game.input.onDown.remove(this.setUserInput,this),this.game.input.onUp.has(this.setUserInput,this)&&this.game.input.onUp.remove(this.setUserInput,this),this.existMoveCallback(this.setMoveUserInput,this)&&this.game.input.deleteMoveCallback(this.setMoveUserInput,this)}setMoveUserInput(t){t.isDown&&this.setUserInput()}existMoveCallback(t,e){const i=this.game.input.moveCallbacks,s=i.length;for(let a=0;a<s;a++){const s=i[a];if(s.callback===t&&s.context===e)return!0}return!1}helpButtonAddTouchPrompt(t,e){this.game.cache.checkImageKey("sparkle_touch")&&(this.sparkleTouchSprites=this.game.add.sprite(t,e,"sparkle_touch"),this.sparkleTouchSprites.anchor.setTo(.5),this.sparkleTouchSprites.scale.setTo(1.5),this.sparkleTouchSprites.animations.add("sparkle_touch"),this.sparkleTouchSprites.visible=!1)}showHelpButtonTouchPrompt(){this.helpBtn&&this.buttonPromptAnimation(this.helpBtn)}hideHelpButtonTouchPrompt(){this.helpCountdownTimer&&(this.helpCountdownTimer.running&&this.helpCountdownTimer.stop(),this.helpCountdownTimer.destroy(),this.helpCountdownTimer=null)}helpButtonCountdowmTime(){this.helpCountdownTimer||!0===this.game.helpBtnTouch||(this.helpCountdownTimer=this.game.time.create(!1),this.helpCountdownTimer.loop(4e3,this.showHelpButtonTouchPrompt,this),this.helpCountdownTimer.start(1e4))}buttonPromptAnimation(t){if(t){const e=1200;this.game.add.tween(t.scale).to({x:[1,1.2,1],y:[1,1.2,1]},400,null,!0),this.game.add.tween(t).to({angle:[0,-15,15,-15,15,-15,15,0]},e,null,!0)}}exitButtonEnableInputAnimation(){this.exitAnimationTimer||(this.exitAnimationTimer=this.game.time.create(!1),this.exitAnimationTimer.add(0,this.showExitButtonTouchPrompt,this),this.exitAnimationTimer.repeat(4e3,2,this.showExitButtonTouchPrompt,this),this.exitAnimationTimer.start(500))}showExitButtonTouchPrompt(){this.exitBtn&&this.buttonPromptAnimation(this.exitBtn)}hideExitButtonTouchPrompt(){this.exitAnimationTimer&&(this.exitAnimationTimer.running&&this.exitAnimationTimer.stop(),this.exitAnimationTimer.destroy(),this.exitAnimationTimer=null)}createGameSuccess(){this.successGroup=this.game.make.group(),this.add(this.successGroup),this.starAnimaMusic=this.game.add.audio("success_audio_star_animation"),this.btnShowMusic=this.game.add.audio("success_audio_btn"),this.reaxPosMusic=[];const t=["success_audio_reaxpos_1","success_audio_reaxpos_2"];for(let e=0;e<t.length;e++){const i=this.game.add.audio(t[e],2);this.reaxPosMusic.push(i)}this.overMask=this.game.add.graphics(0,0),this.overMask.clear(),this.overMask.beginFill(0,.8),this.overMask.drawRect(0,0,this.game.world.width,this.game.world.height),this.overMask.endFill(),this.overMask.inputEnabled=!0,this.successGroup.add(this.overMask),this.starSprite=this.game.add.sprite(this.game.world.centerX,this.game.world.centerY,"success_star_animation",0),this.starSprite.anchor.setTo(.5,.5),this.starSprite.scale.setTo(1.8),this.successGroup.add(this.starSprite),this.successGroup.visible=!1}drawChildGroup(){this.childGroup=this.game.add.group(),this.addChild(this.childGroup)}showStarBurst(t,e,i){this.endSound=this.game.add.audio("ending_sound_end"),this.endSound.play();let s=this.game.add.sprite(t,e,"star_burst_big");s.anchor.setTo(.5),this.childGroup.addChild(s);let a=s.animations.add("star_burst_big");a.onComplete.addOnce(function(){i&&i()},this),a.play(15)}showGameSuccess(){if(this.game.showSuccessStatus)return;if(this.successGroup.visible)return;this.game.world.bringToTop(this),this.successGroup.visible=!0,this.starAnimaMusic.play(),this.starAnimation.play(30);var t=this.game.world.centerY+130,e=this.game.world.centerX;this.replayBtn=this.game.add.button(e-190,t,"success_btn_replay",this.playAgain,this),this.replayBtn.anchor.setTo(.5),this.replayBtn.scale.setTo(0),this.successGroup.add(this.replayBtn),this.nextBtn=this.game.add.button(e,t,"success_btn_continue",this.nextStage,this),this.nextBtn.anchor.setTo(.5),this.nextBtn.scale.setTo(0),this.successGroup.add(this.nextBtn),this.continueBtn=this.game.add.button(e+190,t,"success_btn_continue",this.exitControlGame,this),this.continueBtn.anchor.setTo(.5),this.continueBtn.scale.setTo(0),this.successGroup.add(this.continueBtn);const i=this.game.add.tween(this.continueBtn.scale).to({x:[.6,1.3,.8,.96],y:[.6,1.3,.8,.96]},1e3,"Linear",!0,3500);i.onStart.add(function(){this.btnShowMusic.play()},this),i.onComplete.add(function(){this.game.add.tween(this.continueBtn.scale).to({x:[.96,1.04,.96],y:[.96,1.04,.96]},1e3,"Linear",!0,0,-1)},this);const s=this.game.add.tween(this.replayBtn.scale).to({x:[.6,1.3,.8,.96],y:[.6,1.3,.8,.96]},1e3,"Linear",!0,3e3);s.onStart.add(function(){this.btnShowMusic.play()},this),s.onComplete.add(function(){this.game.add.tween(this.replayBtn.scale).to({x:[1.04,.96],y:[1.04,.96]},1e3,"Linear",!0,0,-1)},this);const a=this.game.add.tween(this.nextBtn.scale).to({x:[.6,1.3,.8,.96],y:[.6,1.3,.8,.96]},1e3,"Linear",!0,3e3);a.onStart.add(function(){this.btnShowMusic.play()},this),a.onComplete.add(function(){this.game.add.tween(this.nextBtn.scale).to({x:[1.04,.96],y:[1.04,.96]},1e3,"Linear",!0,0,-1)},this),this.game.time.events.add(500,function(){const t=this.game.math.between(0,1);this.reaxPosMusic[t].play()},this)}setAgainCallback(t){this.refreshCallback=t}playAgain(t){this.againCallback&&this.againCallback(),this.game.stageIndex=t.difficultValue,dataManage.resetData(),this.game.isRestart=!1,this.backgroundMusic.destroy(),this.backgroundMusic=null,this.helpMusic.destroy(),this.helpMusic=null,this.enableTimer&&this.enableTimer.stop(),this.enableTimer=null,this.hideHelpButtonTouchPrompt(),this.overMask.destroy(!0),this.overMask=null,this.endingGroup.destroy(!0),this.endingGroup=null,this.game.sound.removeAll(!0),this.game.state.restart()}hideGameSuccess(){this.replayBtn.destroy(),this.replayBtn=null,this.continueBtn.destroy(),this.continueBtn=null,this.overMask.inputEnabled=!1,this.visible=!1}exitControlGame(){GameControl&&(GameControl.uploadUserData(dataManage.getUserData()),GameControl.exitGame(this.complete))}nextStage(){void 0===this.game.stageIndex&&(this.game.stageIndex=0),this.game.stageIndex<this.game.Config.stages.length-1&&(this.game.stageIndex+=1),this.playAgain()}onAutoPlayWarn(t){this.game.sound.usingWebAudio&&"suspended"===this.game.sound.context.state&&this.game.input.onTap.addOnce(function(){this.game.sound.context.resume(),t.play()},this)}drawEndingView(){this.endingGroup=this.game.add.group(),this.completeSound=this.game.add.audio("ending_sound_complete"),this.tryAgainSound=this.game.add.audio("ending_sound_tryagain"),this.lockSound=this.game.add.audio("select_lock_difficult_sound"),this.allpassSound=this.game.add.audio("ending_sound_allpass"),this.charSound=this.game.add.audio("ending_sound_char"),this.contBtnSound=this.game.add.audio("ending_sound_continue"),this.unlockSound=this.game.add.audio("ending_sound_unlock"),this.whiteSound=this.game.add.audio("ending_sound_white");var t=this.game.add.graphics(0,0);t.clear(),t.beginFill(0,.8),t.drawRect(0,0,this.game.world.width,this.game.world.height),t.endFill(),t.inputEnabled=!0,this.endingGroup.add(t),this.overMask=t,this.contentGroup=this.game.add.group(),this.endingGroup.addChild(this.contentGroup),this.endingGroup.visible=!1,this.add(this.endingGroup)}showEndingPage(t,e){if(this.endingGroup.visible)return;this.helpMusic.isPlaying&&this.helpMusic.fadeOut(500),this.game.world.bringToTop(this),this.complete=this.getComplete(t),this.endingGroup.visible=!0;const i=this.game.difficultValue;this.unlockDifficlut(this.complete);const s=this.game.difficultValue;console.log("current difficult value = "+s),this.complete?this.showEndingCompleteView(s,i):this.showEndingFailView(s,i),window.dataManage.dataTimeEnd(t,e)}showEndingFailView(t){this.tryAgainSound.play();const e=this.game.add.sprite(this.game.world.centerX,0,"ending_char_fail");e.y=e.height/2,e.anchor.set(.5),this.contentGroup.add(e);const i=this.game.add.sprite(this.game.world.centerX,this.game.world.centerY+134,"ending_char_bar");i.anchor.setTo(.5),this.contentGroup.addChild(i);for(let e=0;e<this.game.diffcultLength;e++){var s=null;if(e>t)(s=this.game.add.button(0,0,"ending_check_lock",this.selectUnclock,this)).anchor.set(.5),s.difficultValue=e;else if(e===t){let i=0;2===t?i=10:0===t&&(i=-10),(s=this.game.add.sprite(0,0,"ending_check_lock")).anchor.set(.5);const n=this.game.add.button(i,0,"ending_bg_white",this.playAgain,this);n.difficultValue=e,n.anchor.set(.5),s.addChild(n);const o=this.game.add.sprite(i,-45,"ending_check_lock");o.anchor.set(.5),s.addChild(o);var a=this.game.stageIndex<t?"ending_btn_difficult_"+e:"ending_btn_tryagain";const h=this.game.add.sprite(i,50,a);h.anchor.set(.5),s.addChild(h),this.unlockDiffucultAnimation(s)}else(s=this.game.add.button(0,0,"ending_check_complete",this.playAgain,this)).anchor.set(.5),s.difficultValue=e;var n=1===e?0:0===e?-1:1;s.x=212*n,s.y=-8,i.addChild(s)}const o=this.game.add.button(1152,600,"success_btn_continue",this.exitControlGame,this);o.anchor.setTo(.5),this.continueButtonAnimation(o),this.contentGroup.addChild(o)}showEndingCompleteView(t,e){this.completeSound.play();const i=this.game.add.sprite(this.game.world.centerX,this.game.world.centerY-128,"ending_animation_star");i.scale.set(1.5),i.anchor.set(.5),this.contentGroup.add(i),i.animations.add("start").play(30,!0);let s=200;const a=this.game.add.sprite(this.game.world.centerX,this.game.world.centerY-65+s,"ending_frame");a.anchor.set(.5),this.contentGroup.addChild(a),this.charSpriteAniamtion(a,"-"+s),s=250;const n=this.game.add.sprite(this.game.world.centerX,0,"ending_char_complete");n.y=n.height/2-40+s,n.anchor.set(.5),this.contentGroup.add(n),this.charSpriteAniamtion(n,"-"+s),this.game.time.events.add(167,function(){this.charSound.play()},this);const o=this.game.add.sprite(this.game.world.centerX,this.game.world.centerY+134,"ending_char_bar");o.anchor.setTo(.5),this.contentGroup.addChild(o);for(let i=0;i<this.game.diffcultLength;i++){var h=null;if(i>t)(h=this.game.add.button(0,0,"ending_check_lock",this.selectUnclock,this)).anchor.set(.5),h.difficultValue=i;else if(i===t){(h=this.game.add.sprite(0,0,"ending_check_lock")).anchor.set(.5);let e=0;2===t?e=10:0===t&&(e=-10);const s=this.game.add.button(e,0,"ending_bg_white",this.playAgain,this);s.difficultValue=i,s.anchor.set(.5),h.addChild(s);const a=this.game.add.sprite(e,-45,"ending_check_lock");a.anchor.set(.5),h.addChild(a);const n=this.game.add.sprite(e,50,"ending_btn_difficult_"+i);n.anchor.set(.5),h.addChild(n),this.unlockDiffucultAnimation(h)}else{(h=h=this.game.add.sprite(0,0,"ending_check_lock")).anchor.set(.5);const s=this.game.add.button(0,0,"ending_check_complete",this.playAgain,this);s.difficultValue=i,s.anchor.set(.5),h.addChild(s),i===t-1&&e<t&&this.completeStageAnimation(s)}var r=1===i?0:0===i?-1:1;h.x=212*r,h.y=-8,o.addChild(h)}const l=this.game.add.button(1132,600,"success_btn_continue",this.exitControlGame,this);if(l.anchor.setTo(.5),this.contentGroup.addChild(l),this.continueButtonAnimation(l),t>=this.game.diffcultLength){const t=this.game.add.sprite(this.game.world.centerX,640,"ending_text_allpass");t.anchor.set(.5),this.contentGroup.addChild(t),this.textAnimation(t)}}selectUnclock(){console.log("difficult lock"),this.lockSound&&!this.lockSound.isPlaying&&this.lockSound.play()}getComplete(t){return"complete"===t}unlockDifficlut(t){t&&this.game.difficultValue===this.game.stageIndex&&this.game.difficultValue<this.game.diffcultLength&&(this.game.difficultValue+=1,window.dataManage.setUnloackDifficult(this.game.difficultValue))}charSpriteAniamtion(t,e,i,s){t.scale.set(0,0);this.game.add.tween(t).to({y:e},167,Phaser.Easing.Quadratic.InOut,!0,100),this.game.add.tween(t.scale).to({x:1.05,y:1.05},167,Phaser.Easing.Quadratic.InOut,!0,100).onComplete.add(function(){this.game.add.tween(t.scale).to({x:[.95,1],y:[.95,1]},134,Phaser.Easing.Quadratic.Out,!0).onComplete.addOnce(function(){s&&s()},this)},this)}completeStageAnimation(t){t.alpha=0,t.scale.set(6.4);t.inputEnabled=!1,this.game.add.tween(t).to({alpha:1},134,Phaser.Easing.Linear.None,!0,233);const e=this.game.add.tween(t.scale).to({x:1,y:1},200,Phaser.Easing.Linear.None,!0,233);e.onStart.addOnce(function(){this.unlockSound.play()},this),e.onComplete.add(function(){t.inputEnabled=!0,this.game.add.tween(t.scale).to({x:[1.2,1],y:[1.2,1]},200,Phaser.Easing.Linear.None,!0)},this)}unlockDiffucultAnimation(t){const e=t.getChildAt(0),i=t.getChildAt(1),s=t.getChildAt(2);e.scale.set(0),i.scale.set(0),s.scale.set(0);this.game.add.tween(s.scale).to({x:1.1,y:1.1},167,Phaser.Easing.Linear.None,!0,1e3).onComplete.add(function(){this.game.add.tween(s.scale).to({x:[.95,1],y:[.95,1]},200,Phaser.Easing.Linear.None,!0)},this);this.game.add.tween(i.scale).to({x:1.1,y:1.1},167,Phaser.Easing.Linear.None,!0,1e3).onComplete.add(function(){this.game.add.tween(i.scale).to({x:[.7,1],y:[.7,1]},200,Phaser.Easing.Linear.None,!0)},this);const a=this.game.add.tween(e.scale).to({x:1.05,y:1.05},167,Phaser.Easing.Linear.None,!0,900);a.onStart.addOnce(function(){this.whiteSound.play()},this),a.onComplete.add(function(){this.game.add.tween(e.scale).to({x:[.95,1.025,1],y:[.95,1.025,1]},200,Phaser.Easing.Linear.None,!0)},this)}textAnimation(t){t.scale.setTo(0);const e=this.game.add.tween(t.scale).to({x:1.1,y:1.1},167,Phaser.Easing.Linear.None,!0,1e3);e.onStart.addOnce(function(){this.allpassSound.play()},this),e.onComplete.add(function(){this.game.add.tween(t.scale).to({x:[.95,1],y:[.95,1]},200,Phaser.Easing.Linear.None,!0)},this)}continueButtonAnimation(t){t.scale.setTo(0);const e=this.game.add.tween(t.scale).to({x:[.6,1.3,.8,.9],y:[.6,1.3,.8,.9]},1e3,"Linear",!0,1500);e.onStart.addOnce(function(){this.contBtnSound.play()},this),e.onComplete.add(function(){this.game.add.tween(t.scale).to({x:[1.1,.9],y:[1.1,.9]},700,"Linear",!0,0,-1)},this)}},ReaxAudiosAssets=function(){return{audio_reaxneg_01:{type:"audio",lang:!0,value:"audio_reaxneg_01.mp3"},audio_reaxneg_03:{type:"audio",lang:!0,value:"audio_reaxneg_03.mp3"},audio_reaxneg_05:{type:"audio",lang:!0,value:"audio_reaxneg_05.mp3"},audio_reaxneg_06:{type:"audio",lang:!0,value:"audio_reaxneg_06.mp3"},audio_reaxneg_07:{type:"audio",lang:!0,value:"audio_reaxneg_07.mp3"},audio_reaxneg_08:{type:"audio",lang:!0,value:"audio_reaxneg_08.mp3"},audio_reaxpos_01:{type:"audio",lang:!0,value:"audio_reaxpos_01.mp3"},audio_reaxpos_02:{type:"audio",lang:!0,value:"audio_reaxpos_02.mp3"},audio_reaxpos_03:{type:"audio",lang:!0,value:"audio_reaxpos_03.mp3"},audio_reaxpos_04:{type:"audio",lang:!0,value:"audio_reaxpos_04.mp3"},audio_reaxpos_05:{type:"audio",lang:!0,value:"audio_reaxpos_05.mp3"},audio_reaxpos_06:{type:"audio",lang:!0,value:"audio_reaxpos_06.mp3"},audio_reaxpos_07:{type:"audio",lang:!0,value:"audio_reaxpos_07.mp3"},audio_reaxpos_08:{type:"audio",lang:!0,value:"audio_reaxpos_08.mp3"},audio_reaxpos_09:{type:"audio",lang:!0,value:"audio_reaxpos_09.mp3"},audio_reaxpos_10:{type:"audio",lang:!0,value:"audio_reaxpos_10.mp3"},audio_reaxpos_11:{type:"audio",lang:!0,value:"audio_reaxpos_11.mp3"}}},ReaxAudios=class{constructor(t,e,i){this.game=t,this.isHummming=!1,this.negList=e&&Array.isArray(e)?e:["audio_reaxneg_01","audio_reaxneg_03","audio_reaxneg_05","audio_reaxneg_06","audio_reaxneg_07","audio_reaxneg_08"],this.posList=e&&Array.isArray(i)?i:["audio_reaxpos_01","audio_reaxpos_02","audio_reaxpos_03","audio_reaxpos_04","audio_reaxpos_05","audio_reaxpos_06","audio_reaxpos_07","audio_reaxpos_08","audio_reaxpos_09","audio_reaxpos_10","audio_reaxpos_11"],this.loadAudio()}loadAudio(){this.audioReasNegList=[];for(let t=0;t<this.negList.length;t++)this.audioReasNegList.push(this.game.add.audio(this.negList[t]));this.audioReasPosList=[];for(let t=0;t<this.posList.length;t++)this.audioReasPosList.push(this.game.add.audio(this.posList[t]));this.audioReasGoodJob=[],this.audioReasGoodJob.push(this.game.add.audio(this.posList[1])),this.audioReasWellDone=[],this.audioReasWellDone.push(this.game.add.audio(this.posList[9]))}getRandomItem(t,e=3){if(null==t||t.length<=0)return;let i=[];if(t.length>e){null==t.hasplayed&&(t.hasplayed=[]);for(let e=0;e<t.length;e++){let s=!1;for(let i=0;i<t.hasplayed.length;i++)if(t[e]==t.hasplayed[i]){s=!0;break}s||i.push(t[e])}}else i=t;let s=i[this.game.math.between(0,i.length-1)];if(t.length>e){null==t.hasplayed&&(t.hasplayed=[]);for(let i=e-1;i>=0;i--)t.hasplayed[i]=i>0?t.hasplayed[i-1]:s}return s}playRandomAudio(t,e){if(null==t||t.length<=0)return void(e&&e());let i=this.getRandomItem(t,3);return i.play(),e&&i.onStop.addOnce(function(){e()}),i}showPositiveHumm(t){this.isHummming||(this.isHummming=!0,this.playRandomAudio(this.audioReasPosList,()=>{this.isHummming=!1,t&&t()})),window.dataManage.effectiveAction()}showNegativeHumm(t){this.isHummming||(this.isHummming=!0,this.playRandomAudio(this.audioReasNegList,()=>{this.isHummming=!1,t&&t()})),window.dataManage.faultAction()}playAudioGoodJob(t){this.playRandomAudio(this.audioReasGoodJob,()=>{t&&t()}),window.dataManage.effectiveAction()}playAudioWellDone(t){this.playRandomAudio(this.audioReasWellDone,()=>{t&&t()}),window.dataManage.effectiveAction()}},LoadProgressBarAssets=function(){return{loading_progress:{type:"images",value:"loading_progress.png"},loading_total:{type:"images",value:"loading_total.png"},loading_bg:{type:"images",lang:!0,value:"loading_bg.jpg"}}},LoadProgressBar=class extends Phaser.Group{constructor(t){super(t),this.autoStartGame=t.Config.common.autoStartGame,this.showProgressBar=t.Config.common.showProgressBar,this.createProgressBar(),this.visibilityListener(t)}createProgressBar(){if(!this.showProgressBar)return;this.loadBgSprite=this.game.make.image(this.game.world.centerX,this.game.world.centerY,"loading_bg"),this.loadBgSprite.anchor.set(.5),this.add(this.loadBgSprite),this.sliderTrack=this.game.make.image(0,0,"loading_total");const t=(this.game.width-this.sliderTrack.width)/2,e=this.game.height/2-this.sliderTrack.height+240;this.sliderTrack.x=t,this.sliderTrack.y=e,this.progressBar=this.game.add.image(t,e,"loading_progress"),this.game.load.setPreloadSprite(this.progressBar),this.add(this.sliderTrack),this.add(this.progressBar),GameControl.indicateActivityReady()}loadComplete(t){const e=window.GameControl.getActivityId();this.game.difficultValue=window.GameControl.getActivityDifficult()-1;const i={deviceModel:window.navigator.userAgent,activityId:e,difficult:this.game.difficultValue};window.dataManage=new DataManage(i);const s=new Object;s.start=t,s.pause=function(){this.paused=!0,console.log("paused game")}.bind(this.game),s.resume=function(){this.paused=!1,console.log("resume game")}.bind(this.game),window.GameControl.setActivityControl(s),t&&t()}visibilityListener(t){document.addEventListener("visibilitychange",()=>{console.log("visibilitychange"),document.hidden?(t.sound.mute||t.sound.setMute(),t.paused=!0):(t.sound.mute||t.sound.unsetMute(),t.paused=!1)},!1)}},GestureTiperAssets=function(){return{gesturetiper_hand:{type:"images",value:"gesturetiper_hand.png"},gesturetiper_star_burst:{type:"atlas",value:"gesturetiper_star_burst.png",json:"gesturetiper_star_burst.json"},gesturetiper_star_little_1:{type:"atlas",value:"gesturetiper_star_little_1.png",json:"gesturetiper_star_little_1.json"},gesturetiper_star_little_2:{type:"atlas",value:"gesturetiper_star_little_2.png",json:"gesturetiper_star_little_2.json"},gesturetiper_star_little_3:{type:"atlas",value:"gesturetiper_star_little_3.png",json:"gesturetiper_star_little_3.json"}}},GestureTiper=class extends Phaser.Group{constructor(t,e={}){super(t),this.game=t,this.keyHand=e.keyHand||"gesturetiper_hand",this.keyStar=e.keyStar||"gesturetiper_star_burst",this.SlideDirection={Horizontal:0,Vertical:1},this.slideOffset={x:150,y:150},this.durationAlphaTween=200,this.durationDragTween=800,this.dragSpeed=4/15,this.easingLinear=Phaser.Easing.Linear.None,this.isTiping=!1,this.visible=!1}loadSprites(t,e){const i={},s=this.game.add.sprite(t.x,t.y,this.keyStar);s.anchor.setTo(.5),s.visible=!1;const a=s.animations.add(this.keyStar);e.addChild(s);const n=this.game.add.group();e.addChild(n);const o=this.game.add.sprite(t.x,t.y,this.keyHand);return o.anchor.setTo(.2),e.addChild(o),i.starSprite=s,i.starAnimation=a,i.handSprite=o,i.trailStarGroup=n,i}showSlide(t,e,i){this.destroy(!0,!0);let s=this.game.add.group();this.addChild(s);const a=this.loadSprites(t,s);this.visible=!0,this.isTiping=!0;let n=this.slideOffset.x,o=this.slideOffset.y;e==this.SlideDirection.Vertical?n=0:o=0;let h=Phaser.Easing.Cubic.Out;const r=this.durationAlphaTween;a.handSprite.alpha=0;let l=this.game.add.tween(a.handSprite);l.to({alpha:1},r,h,!0).onComplete.addOnce(function(){this.game.add.tween(a.handSprite).to({x:a.handSprite.x-n,y:a.handSprite.y-o},700,h,!0).onComplete.addOnce(function(){this.game.add.tween(a.handSprite).to({alpha:0},r,h,!0).onComplete.addOnce(function(){a.handSprite.x=t.x,a.handSprite.y=t.y,d.start()},this)},this)},this),l.onStart.addOnce(function(){this.drawDragStarTrack(a,700,50)},this);let d=this.game.add.tween(a.handSprite);d.to({alpha:1},r,h,!1).onComplete.addOnce(function(){this.game.add.tween(a.handSprite).to({x:a.handSprite.x+n,y:a.handSprite.y+o},700,h,!0).onComplete.addOnce(function(){this.game.add.tween(a.handSprite).to({alpha:0},r,h,!0).onComplete.addOnce(function(){a.handSprite.x=t.x,a.handSprite.y=t.y,this.isTiping=!1,this.visible=!1,i&&i()},this)},this)},this),d.onStart.addOnce(function(){this.drawDragStarTrack(a,700,50)},this)}showRepeatSlide(t,e,i=1,s=0,a){let n=0,o={},h=function(){n++,a&&a(n),this.game.time.events.add(s,function(){o.forceStop||(-1==i||n<i)&&(o.group=this.showSlide(t,e,h))},this)}.bind(this);return o.group=this.showSlide(t,e,h),o.stop=function(t){o.forceStop=!0,t&&(o.group.visible=!1)},o}showTap(t,e){null==t.length&&(t=[t]),this.destroy(!0,!0);let i=this.game.add.group();this.addChild(i);for(let s=0;s<t.length;s++){const a=t[s],n=this.loadSprites(a,i);this.visible=!0,this.isTiping=!0,n.handSprite.alpha=0;const o=this.durationAlphaTween,h=this.easingLinear;this.game.add.tween(n.handSprite).to({alpha:1},o,h,!0).onComplete.addOnce(function(){this.game.time.events.add(500,function(){n.starSprite.visible=!0,n.starAnimation.play(15),n.starAnimation.onComplete.addOnce(function(){0===s&&(this.isTiping=!1,this.visible=!1,e&&e())},this)},this);this.game.add.tween(n.handSprite.scale).to({x:.9,y:.9},500,Phaser.Easing.Linear.None,!0,0,0,!0).onComplete.addOnce(function(){this.game.add.tween(n.handSprite).to({alpha:0},o,h,!0,100)},this)},this)}return i}showRepeatTaps(t,e=1,i=0,s){let a=0,n={},o=function(){a++,s&&s(a),this.game.time.events.add(i,function(){n.forceStop||(-1==e||a<e)&&(n.group=this.showTap(t,o))},this)}.bind(this);return n.group=this.showTap(t,o),n.stop=function(t){n.forceStop=!0,t&&(n.group.visible=!1)},n}getDistance(t,e){let i=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y);return Math.sqrt(i*i+s*s)}showDrag(t,e,i,s=null){this.destroy(!0,!0),this.visible=!0,this.isTiping=!0;let a=this.game.add.group();this.addChild(a),null==e.length&&(e=[e]);const n=this.loadSprites(t,a),o=this.durationAlphaTween,h=this.easingLinear,r=Phaser.Easing.Cubic.Out;let l={x:[],y:[]},d=0;for(let i=0;i<e.length;i++)d+=this.getDistance(e[i],e[i-1]||t),l.x.push(e[i].x),l.y.push(e[i].y);const u=s||d/this.dragSpeed;return this.drawDragStarTrack(n,u),n.handSprite.alpha=0,this.game.add.tween(n.handSprite).to({alpha:1},o,h,!0).onComplete.addOnce(function(){this.game.add.tween(n.handSprite).to({x:l.x,y:l.y},u,r,!0).onComplete.addOnce(function(){this.game.add.tween(n.handSprite).to({alpha:0},o,h,!0).onComplete.addOnce(function(){this.visible=!1,this.isTiping=!1,i&&i()},this)},this)},this),a}showRepeatDrags(t,e,i=1,s=0,a,n=null){let o=0,h={},r=function(){o++,a&&a(o),this.game.time.events.add(s,function(){h.forceStop||(-1==i||o<i)&&(h.group=this.showDrag(t,e,r,n))},this)}.bind(this);return h.group=this.showDrag(t,e,r,n),h.stop=function(t){h.forceStop=!0,t&&(h.group.visible=!1)},h}drawDragStarTrackSprite(t,e){this.keyTrailStar1="gesturetiper_star_little_1",this.keyTrailStar2="gesturetiper_star_little_2",this.keyTrailStar3="gesturetiper_star_little_3";let i=this.jstar_rand(-1,1),s=this.jstar_rand(-1,1),a=this.jstar_rand(10,30),n=this.jstar_rand(10,30),o=e.x+i*a,h=e.y+s*n;const r=this.game.add.sprite(o,h,this.keyTrailStar1);r.anchor.set(.5),r.scale.setTo(1),t.add(r),r.animations.add(this.keyTrailStar1,this.getSpriteSheetsArray()).play(16).onComplete.add(function(){r.visible=!1,r.destroy()},this),this.game.add.tween(r).to({alpha:0},1e3,null,!0,200),o+=this.jstar_rand(10,20),h+=this.jstar_rand(10,20);const l=this.game.add.sprite(o,h,this.keyTrailStar2);l.anchor.set(.5),l.scale.setTo(1),t.add(l),l.animations.add(this.keyTrailStar2,this.getSpriteSheetsArray()).play(16).onComplete.add(function(){l.visible=!1,l.destroy()},this),this.game.add.tween(l).to({alpha:0},1e3,null,!0,200),i=this.jstar_rand(-1,1),s=this.jstar_rand(-1,1),a=this.jstar_rand(5,20),n=this.jstar_rand(5,20),o=e.x+i*a,h=e.y+s*n;const d=this.game.add.sprite(o,h,this.keyTrailStar3);d.anchor.set(.5),d.scale.setTo(1),t.add(d),d.animations.add(this.keyTrailStar3,this.getSpriteSheetsArray()).play(24).onComplete.add(function(){d.visible=!1,d.destroy()},this),this.game.add.tween(d).to({alpha:0},500,null,!0,500)}drawDragStarTrack(t,e,i){const s=t.trailStarGroup,a=t.handSprite;s.removeAll();const n=this.durationAlphaTween,o=Phaser.Easing.Linear.None,h=e||this.durationDragTween,r=i||20,l=this.game.time.create(!1);l.loop(r,function(){this.drawDragStarTrackSprite(s,a.position)},this),s.alpha=0,this.drawDragStarTrackSprite(s,a.position),this.game.add.tween(s).to({alpha:1},n,o,!0).onComplete.addOnce(function(){l.start(),this.game.time.events.add(this.getStarDuration(h),function(){l.stop()},this)},this)}jstar_rand(t,e){let i=Math.random();return i*=e-t,i+=t,i=Math.round(i)}getSpriteSheetsArray(){const t=this.game.math.between(0,15),e=[];for(let t=0;t<16;t++)e.unshift(t);if(15===t)return e;for(let i=14;i>t;i--)e.unshift(i);return e}getStarDuration(t){return t<2e3?t/10*7:t-800}setDragSpeed(t){this.dragSpeed=t}},ProgressBarAssets=function(){return{progress_bar_1:{type:"images",value:"progress_bar_1.png"},progress_bar_2:{type:"images",value:"progress_bar_2.png"},progress_bar_3:{type:"images",value:"progress_bar_3.png"}}},ProgressBar=class extends Phaser.Group{constructor(t,e,i){super(t),this.distanceTotal=373,this.starCount=0,this.starsConfig=i||[1],this.totalCount=e,this.drawProgressView()}drawProgressView(){const t=this.game.make.image(0,0,"progress_bar_1");t.anchor.set(.5,0),this.add(t);t.width;const e=t.height;this.progressBar=this.game.make.sprite(0,0,"progress_bar_2"),this.progressWidth=this.progressBar.width,this.progressHeight=this.progressBar.height,this.progressBar.position.y=e-(e-this.progressHeight)/2,this.progressBar.anchor.set(.5,1),this.rect=new Phaser.Rectangle(0,this.progressHeight,this.progressWidth,this.progressHeight),this.progressBar.crop(this.rect),t.addChild(this.progressBar),this.progressTop=this.game.make.image(0,0,"progress_bar_3"),this.progressTop.anchor.set(.5,0),t.addChild(this.progressTop)}setPosition(t,e){this.position.setTo(t,e)}setAngle(t){this.angle=t}setProcessTweenDuration(t){this.processTweenDuration=t}updateProgressBar(t){if(this.currentCount>=this.totalCount)return;this.currentCount=t;const e=this.currentCount/this.totalCount;e!==this.progressPercentage&&(this.progressPercentage=e,this.rect.y=this.progressHeight-this.progressHeight*this.progressPercentage,this.progressBar.updateCrop()),1===parseInt(this.progressPercentage)&&this.complete()}complete(){}},ArrowButtonsAssets=function(){return{btn_left:{type:"images",value:"btn_left.png"},btn_right:{type:"images",value:"btn_right.png"},btn_up:{type:"images",value:"btn_up.png"},btn_down:{type:"images",value:"btn_down.png"}}},ArrowButtons=class extends Phaser.Group{constructor(t,e){super(t),this.init(),this.setConfig(e),this.drawView()}init(){this.leftBtn=null,this.rightBtn=null,this.context=null,this.direction=null,this.distance=null,this.leftBtnKey=null,this.rightBtnKey=null,this.leftBtnClickCallback=null,this.rightBtnClickCallback=null}setConfig(t){this.context=t.context,this.distance=t.distance?t.distance:400,this.leftBtnClickCallback=t.leftBtnClickCallback,this.rightBtnClickCallback=t.rightBtnClickCallback,this.direction=t.direction?t.direction:"horizontal",this.leftBtnKey="horizontal"===this.direction?"btn_left":"btn_up",this.rightBtnKey="horizontal"===this.direction?"btn_right":"btn_down"}drawView(){this.leftBtn=this.game.add.button(0,0,this.leftBtnKey,this.leftBtnClickCallback,this.context),this.add(this.leftBtn),this.rightBtn=this.game.add.button(this.leftBtn.x+this.distance,0,this.rightBtnKey,this.rightBtnClickCallback,this.context),this.add(this.rightBtn)}buttonAnimation(t){t.onInputDown.add(function(){t.scale.setTo(.9,.9),this.game.add.tween(t.scale).to({x:1.1,y:1.1},100,Phaser.Easing.Linear.None,!0,0,0,!1)},this),t.onInputUp.add(function(){this.game.add.tween(t.scale).to({x:1,y:1},100,Phaser.Easing.Linear.None,!0,0,0,!1)},this)}getLeftBtn(){return this.leftBtn}getRightBtn(){return this.rightBtn}},DifficultPageAssets=function(){return{difficut_page_bg:{type:"images",value:"difficult_page_bg.jpg"},difficult_page_plate1:{type:"images",lang:!0,value:"difficult_page_plate1_01.png"},difficult_page_plate1_complete:{type:"images",lang:!0,value:"difficult_page_plate1_02.png"},difficult_page_plate2:{type:"images",lang:!0,value:"difficult_page_plate2_01.png"},difficult_page_plate2_complete:{type:"images",lang:!0,value:"difficult_page_plate2_02.png"},difficult_page_plate2_lock:{type:"images",lang:!0,value:"difficult_page_plate2_03.png"},difficult_page_plate3:{type:"images",lang:!0,value:"difficult_page_plate3_01.png"},difficult_page_plate3_complete:{type:"images",lang:!0,value:"difficult_page_plate3_02.png"},difficult_page_plate3_lock:{type:"images",lang:!0,value:"difficult_page_plate3_03.png"},select_lock_difficult_sound:{type:"audio",lang:!0,value:"select_lock_difficult_sound.mp3"}}},DifficultPage=class extends Phaser.Group{constructor(t){super(t),this.init(),this.create()}init(){this.offestX=30,this.difficultValue=this.game.difficultValue,this.difficultCallback=null,this.backgroundKey="difficut_page_bg",this.difficultKeyList=[{name:"easy",key:"difficult_page_plate1",completeKey:"difficult_page_plate1_complete"},{name:"middle",key:"difficult_page_plate2",completeKey:"difficult_page_plate2_complete",lockKey:"difficult_page_plate2_lock"},{name:"hard",key:"difficult_page_plate3",completeKey:"difficult_page_plate3_complete",lockKey:"difficult_page_plate3_lock"}],this.game.diffcultLength=3}create(){this.lockSound=this.game.add.audio("select_lock_difficult_sound"),this.backgroundSprite=this.game.add.image(0,0,this.backgroundKey),this.add(this.backgroundSprite),this.difficultGroup=this.game.add.group(),this.difficultKeyList.forEach(function(t,e){var i=null;e>this.difficultValue?(i=this.game.add.button(0,0,t.lockKey,this.selectLockDifficult,this)).isComplete=!1:e===this.difficultValue?(i=this.game.add.button(0,0,t.key,this.selectDifficult,this),this.scaleAnimations(i),i.isComplete=!1):(i=this.game.add.button(0,0,t.completeKey,this.selectDifficult,this)).isComplete=!0,i.anchor.set(.5);let s=1===e?0:0===e?-1:1;i.x=this.game.world.centerX+(this.offestX+i.width)*s,i.y=this.game.world.centerY,i.diffName=t.name,i.difficultValue=e,this.difficultGroup.addChild(i)}.bind(this)),window.GameControl.loadAssetsComplete()}selectDifficult(t){console.log(t.diffName),this.game.stageIndex=t.difficultValue,this.difficultCallback&&this.difficultCallback()}selectLockDifficult(t){console.log(t.diffName+" LOCK"),this.lockSound.isPlaying||this.lockSound.play()}setSelectDiffCallback(t){this.difficultCallback=t}scaleAnimations(t){this.game.add.tween(t.scale).to({x:[1.04,1,.96,1],y:[1.04,1,.96,1]},736,Phaser.Easing.Linear.None,!0,0,-1).yoyo=!0}};function DataManage(t){this.init(t)}window.Editor=window.Editor||{},Editor.Template=function(){var t=function(){const t=0,e=1,i=2,s=3,a=-1,n={Center:0,Left:-1,Right:1};function o(t,e){this.game=t,this.x=e.x||0,this.y=e.y||0,this.key=e.key,this.keyLeft=e.keyLeft,this.keyRight=e.keyRight,this.rate=e.rate,this.rateLeft=e.rateLeft,this.rateRight=e.rateRight,this.anchor=e.anchor||.5,this.scale=e.scale||.8,this.bodySize=e.bodySize,this.flyOffsetX=230,this.currentKey=null,this.isTurning=!1,this.position=n.Center,this.init()}return o.prototype.init=function(){this.sprite=this.game.add.sprite(this.x,this.y,this.key),this.animation=this.sprite.animations.add(this.key),this.sprite.anchor.setTo(this.anchor),this.sprite.scale.setTo(this.scale),this.currentKey=this.key,this.bodySize&&(this.game.physics.arcade.enable(this.sprite),this.sprite.body.setSize(this.sprite.width/2,this.sprite.height/2,this.sprite.width/4,this.sprite.height/4)),this.setPosition(n.Center)},o.prototype.setFlyOffset=function(t){this.flyOffsetX=t},o.prototype.getPosition=function(){return this.position},o.prototype.setPosition=function(t){this.position=t},o.prototype.setState=function(t){this.state=t},o.prototype.getState=function(){return this.state},o.prototype.getSprite=function(){return this.sprite},o.prototype.getCurrentKey=function(){return this.currentKey},o.prototype.stop=function(){this.setState(t)},o.prototype.fly=function(){this.sprite.loadTexture(this.key),this.currentKey=this.key,this.animation=this.sprite.animations.add(this.key),this.animation.play(this.rate,!0),this.setState(e)},o.prototype.flyLeft=function(t){if(this.isTurning)return;let e;this.isTurning=!0,this.sprite.loadTexture(this.keyLeft),this.currentKey=this.keyLeft,this.animation=this.sprite.animations.add(this.keyLeft),this.animation.play(this.rateLeft).onComplete.add(function(){this.fly(),this.isTurning=!1,this.position==n.Center?this.setPosition(n.Left):this.position==n.Right&&this.setPosition(n.Center)},this),this.setState(i),e=t?this.sprite.x-this.flyOffsetX:[this.sprite.x-50,this.sprite.x],tween=this.game.add.tween(this.sprite).to({x:e},this.animation.frameTotal/this.rateLeft*500,"Linear",!0)},o.prototype.flyRight=function(t){if(this.isTurning)return;let e;this.isTurning=!0,this.sprite.loadTexture(this.keyRight),this.currentKey=this.keyRight,this.animation=this.sprite.animations.add(this.keyRight),this.animation.play(this.rateRight).onComplete.add(function(){this.fly(),this.isTurning=!1,this.position==n.Center?this.setPosition(n.Right):this.position==n.Left&&this.setPosition(n.Center)},this),this.setState(s),e=t?this.sprite.x+this.flyOffsetX:[this.sprite.x+50,this.sprite.x],tween=this.game.add.tween(this.sprite).to({x:e},this.animation.frameTotal/this.rateRight*500,"Linear",!0)},o.prototype.destroy=function(){this.setState(a),this.sprite.kill()},o}(),e=function(){const t=-1,e=0,i=1;function s(t,e){this.game=t,this.x=e.x||0,this.y=e.y||0,this.type=e.type,this.anchor={x:.5,y:.5},this.scale=e.scale||1,this.KEY={Center:e.obstacleKey,Left:e.obstacleLeftKey,Right:e.obstacleRightKey},this.KEY_SHADOW={Center:e.obstacleShadowKey,Left:e.obstacleShadowLeftKey,Right:e.obstacleShadowRightKey},this.init()}return s.prototype.init=function(){this.treeConfig=this.getTreeConfig(this.type),this.sprite=this.game.make.sprite(0,0,this.treeConfig.key),this.sprite.anchor.setTo(this.anchor.x,this.anchor.y),this.spriteShadow=this.game.add.sprite(this.x,this.y,this.treeConfig.keyShadow),this.spriteShadow.anchor.setTo(.5,.5),this.spriteShadow.scale.setTo(this.scale),this.game.physics.arcade.enable(this.spriteShadow);let t=this.treeConfig.bodySize;this.spriteShadow.body.setSize(t.w,t.h,t.x,t.y),this.spriteShadow.addChild(this.sprite)},s.prototype.getType=function(){return this.type},s.prototype.getSprite=function(){return this.spriteShadow},s.prototype.getTreeConfig=function(s){let a={};switch(s){case t:a.key=this.KEY.Left,a.keyShadow=this.KEY_SHADOW.Left,a.bodySize={w:80,h:100,x:60,y:54};break;case i:a.key=this.KEY.Right,a.keyShadow=this.KEY_SHADOW.Right,a.bodySize={w:80,h:100,x:60,y:54};break;case e:a.key=this.KEY.Center,a.keyShadow=this.KEY_SHADOW.Center,a.bodySize={w:80,h:100,x:60,y:54};break;default:console.log("Tree","Wrong type:"+s)}return a},s.prototype.destroy=function(){this.sprite.kill()},s}();function i(){}function s(){}function a(){}i.prototype.init=function(){this.input.maxPointers=1,this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0},i.prototype.preload=function(){Until.loadCommonAssets(LoadProgressBarAssets(),this.game)},i.prototype.create=function(){this.state.start("Preloader")},s.prototype.init=function(){this.game.assetData=Until.dataFromatAsstes()},s.prototype.preload=function(){this.loadProgressBar=new LoadProgressBar(this.game),Until.loadAssets(this.game.assetData,this.game),Until.loadCommonAssets(DifficultPageAssets(),this.game),Until.loadCommonAssets(GestureTiperAssets(),this.game),Until.loadCommonAssets(ReaxAudiosAssets(),this.game),Until.loadCommonAssets(ProgressBarAssets(),this.game),Until.loadCommonAssets(ArrowButtonsAssets(),this.game),Until.loadCommonAssets(SystemButtonsAssets(),this.game)},s.prototype.create=function(){this.loadProgressBar.loadComplete(function(){this.startGmae()}.bind(this))},s.prototype.startGmae=function(){this.state.start("DifficultScene"),console.log("start game")},a.prototype.init=function(){},a.prototype.preload=function(){},a.prototype.create=function(){this.difficultPage=new DifficultPage(this.game),this.difficultPage.setSelectDiffCallback(this.selectDifficult.bind(this))},a.prototype.selectDifficult=function(){this.state.start("GamePlay")};function n(){}function o(){}return n.prototype.init=function(){this.letsFly=!0,this.gameStop=!1,this.audioTap=!0,this.hasTiped=!1,this.isTiping=!1,this.gameStart=!1,this.gameScceed=!1,this.hasEffectiveOperation=!1,this.operationType=this.game.Config.common.operationType,this.count=0,this.offsetX=230,this.flyedPosition=0,this.treeConfigList=[],this.stageIndex=this.getStageIndex(),this.currStage=this.getCurrentStage(this.stageIndex),this.setAssetsKeyWithStage(),this.isRoleTarget=this.currStage.game.isRoleTarget,this.moveSpeed=this.currStage.game.moveSpeed,this.obstacleLine=this.currStage.game.obstacleLine,this.isTween=this.currStage.game.isSuccessRunAni,this.distanceBack=500,this.firstObsPosition=800,this.safeNumber=360,this.safeDistanceScale=parseFloat(this.currStage.game.safeDistanceScale),this.obstanceDistance=this.safeNumber*this.safeDistanceScale,this.dizzyX=this.currStage.game.dizzyPositionX,this.dizzyY=this.currStage.game.dizzyPositionY,this.offsetNor=Editor.Config.setting.vertical.y,this.offsetDis=this.currStage.game.offsetDis},n.prototype.getStageIndex=function(){return this.game.stageIndex?this.game.stageIndex:0},n.prototype.getCurrentStage=function(t){return this.game.Config.stages[t]},n.prototype.setAssetsKeyWithStage=function(t){this.mapStartKey=this.getAssetsKey("mapStart"),this.mapMidKey=this.getAssetsKey("mapMid"),this.mapEndKey=this.getAssetsKey("mapEnd"),this.obstacleKey=this.getAssetsKey("obstacle"),this.obstacleLeftKey=this.getAssetsKey("obstacleLeft"),this.obstacleRightKey=this.getAssetsKey("obstacleRight"),this.obstacleShadowKey=this.getAssetsKey("obstacleShadow"),this.obstacleShadowLeftKey=this.getAssetsKey("obstacleShadowLeft"),this.obstacleShadowRightKey=this.getAssetsKey("obstacleShadowRight"),this.backgroundSoundKey=this.getAssetsKey("backgroundSound"),this.narrationKey=this.getAssetsKey("narration"),this.ambientMusicKey=this.getAssetsKey("ambientMusic"),this.objClashedSoundKey=this.getAssetsKey("objClashedSound"),this.runSoundKey=this.getAssetsKey("runSound"),this.charClashSoundKey=this.getAssetsKey("charClashSound"),this.sideClashSoundKey=this.getAssetsKey("sideClashSound"),this.moveSoundKey=this.getAssetsKey("moveSound"),this.correctSoundKey=this.getAssetsKey("correctSound"),this.tapSoundKey=this.getAssetsKey("tapSound"),this.roleMainKey=this.getAssetsKey("roleMain"),this.roleMainLeftKey=this.getAssetsKey("roleMainLeft"),this.roleMainRightKey=this.getAssetsKey("roleMainRight"),this.roleTargetKey=this.getAssetsKey("roleTarget"),this.roleTargetLeftKey=this.getAssetsKey("roleTargetLeft"),this.roleTargetRightKey=this.getAssetsKey("roleTargetRight"),this.dizzyKey=this.getAssetsKey("dizzy_animation")},n.prototype.getAssetsKey=function(t){const e="stage-"+this.stageIndex+"_";return this.game.assetData[e+t].key},n.prototype.preload=function(){},n.prototype.create=function(){this.runwayLength=this.getRunwayLength(),this.game.physics.startSystem(Phaser.Physics.ARCADE),this.loadAudio(),this.loadGame(),this.systemBtns=new SystemButtons(this.game,this.backgroundSoundKey,null,this.narrationKey,null),this.systemBtns.setExitCallback(this.exitGame.bind(this)),this.systemBtns.setHelpCallback(this.showTips.bind(this)),this.startGame(),window.DeviceOrientationEvent?window.addEventListener("deviceorientation",this.orientationMove.bind(this),!1):console.log("UNSUPPORTED DeviceOrientationEvent")},n.prototype.update=function(){this.gameStart&&(this.gameStop||this.gameScceed||this.letsFly&&(this.isRoleTarget&&this.game.physics.arcade.overlap(this.jamesSprite,this.treeGroup,this.checkJames,null,this),this.game.physics.arcade.overlap(this.sofiaSprite,this.treeGroup,this.checkSofia,null,this),this.mapGroup.y>0?(this.mapGroup.y=0,this.gameStop=!0,this.gameComplete()):(this.mapGroup.y+=3*this.moveSpeed,this.flyedPosition+=3*this.moveSpeed,this.scoreTimer.updateProgressBar(this.flyedPosition)),this.flyedPosition>400+this.offsetDis&&!this.hasTiped&&(this.audioGallop.pause(),this.showFirstTip())))},n.prototype.loadAudio=function(){this.audioBushImpact=this.add.audio(this.objClashedSoundKey),this.audioGallop=this.add.audio(this.runSoundKey),this.audioGallop.loop=!0,this.audioCharacterClash=this.add.audio(this.charClashSoundKey),this.audioMove=this.add.audio(this.moveSoundKey),this.audioAmbience=this.add.audio(this.ambientMusicKey),this.audioAmbience.loop=!0,this.audioIncorrect=this.add.audio(this.sideClashSoundKey),this.audioSelect=this.add.audio(this.tapSoundKey),this.audioCorrect=this.add.audio(this.correctSoundKey),this.audioReas=new ReaxAudios(this.game)},n.prototype.loadGame=function(){this.contentGroup=this.add.group(),this.gestureTiper=new GestureTiper(this.game),this.loadMap(this.contentGroup),this.loadCharacter(),this.loadProcessBar(this.contentGroup),this.contentGroup.addChild(this.gestureTiper)},n.prototype.loadProcessBar=function(t){this.scoreTimer=new ProgressBar(this.game,(this.runwayLength+1)*this.world.height),this.scoreTimer.setPosition(60,160),t.addChild(this.scoreTimer)},n.prototype.loadCharacter=function(){this.sofiaObject=new t(this.game,{x:this.world.centerX,y:this.world.centerY+200+480,key:this.roleMainKey,keyLeft:this.roleMainLeftKey,keyRight:this.roleMainRightKey,rate:this.currStage.assets.roleMain.rate,rateLeft:this.currStage.assets.roleMainLeft.rate,rateRight:this.currStage.assets.roleMainRight.rate,bodySize:{w:20,h:30,x:60,y:30}}),this.sofiaObject.setFlyOffset(this.offsetX),this.sofiaSprite=this.sofiaObject.getSprite(),this.contentGroup.addChild(this.sofiaSprite),this.isRoleTarget&&(this.jamesObject=new t(this.game,{x:this.world.centerX,y:this.world.centerY-50+480,key:this.roleTargetKey,keyLeft:this.roleTargetLeftKey,keyRight:this.roleTargetRightKey,rate:this.currStage.assets.roleTarget.rate,rateLeft:this.currStage.assets.roleTargetLeft.rate,rateRight:this.currStage.assets.roleTargetRight.rate,bodySize:{w:20,h:30,x:60,y:30}}),this.jamesObject.setFlyOffset(this.offsetX),this.jamesSprite=this.jamesObject.getSprite(),this.contentGroup.addChild(this.jamesSprite)),this.sofiaDizzy=this.add.sprite(0,0,this.dizzyKey),this.sofiaDizzy.anchor.setTo(.5),this.sofiaDizzy.visible=!1,this.sofiaSprite.addChild(this.sofiaDizzy)},n.prototype.loadMap=function(t){this.mapGroup=this.add.group(),t.add(this.mapGroup),this.treeGroup=this.add.group();let e=[this.mapStartKey,this.mapMidKey,this.mapEndKey],i=this.runwayLength+1;for(let t=i;t>=0;t--)if(0==t||t==i){let s=0==t?0:e.length-1,a=720*(i-t),n=this.add.sprite(this.world.centerX,a,e[s]);t==i&&(this.mapStartDis=n.height),n.anchor.set(.5,0),this.mapGroup.addChild(n)}else{let s=720*(i-t),a=this.add.sprite(this.world.centerX,s,e[1]);a.anchor.set(.5,0),this.mapGroup.addChild(a)}const s=this.mapGroup.height;for(let t=0;t<this.obstacleLine;t++){let e=this.getTreeType();for(let i=0;i<e.length;i++){if(0==e[i])continue;let a=0==i?-1:1==i?0:1,n=s-(this.firstObsPosition+this.obstanceDistance*t);this.loadTree({position:n,type:a,typeList:e})}}this.mapGroup.addChild(this.treeGroup),this.mapGroup.position.y=720-this.mapGroup.height},n.prototype.getTreeType=function(){let t,e=this.obstacleLine,i=parseInt(e/2),s=e-this.treeConfigList.length;if(5===this.obstacleLine){const t=[[0,1,0],[0,0,1],[0,1,0],[1,0,0],[0,1,0]][s-1];return this.treeConfigList.push(t),t}return s==e?t=[0,1,0]:e<=7?(t=[0,0,0],this.treeConfig(t,1)):e>=11?(t=[1,1,1],this.treeConfig(t,0)):s>i?(t=[0,0,0],this.treeConfig(t,1)):s==i?t=[1,0,1]:(t=[1,1,1],this.treeConfig(t,0)),this.treeConfigList.push(t),t},n.prototype.treeConfig=function(t,e){let i=this.math.between(0,2);if(this.treeConfigList.length>0){let i=this.treeConfigList[this.treeConfigList.length-1];t[this.getRamdomIndex(i,e)]=e}else t[i]=e},n.prototype.getRamdomIndex=function(t,e){if(null==t||null==e)return;let i=[];for(let s=0;s<t.length;s++){let a;t[s]==e&&(a=s,i.push(s)),0==e&&(0==a?i.push(2):2==a&&i.push(0))}let s=[0,1,2];return this.subtractionArray(s,i),s[this.math.between(0,s.length-1)]},n.prototype.subtractionArray=function(t,e,i){if(i){let i;t=t.concat(i),e=e.concat(i)}for(let i=t.length-1;i>=0;i--){let s=t[i];for(let a=e.length-1;a>=0;a--){if(s==e[a]){t.splice(i,1),e.splice(a,1);break}}}return t},n.prototype.loadTree=function(t){let i=new e(this.game,{x:this.world.centerX+t.type*this.offsetX,y:t.position,type:t.type,obstacleKey:this.obstacleKey,obstacleLeftKey:this.obstacleLeftKey,obstacleRightKey:this.obstacleRightKey,obstacleShadowKey:this.obstacleShadowKey,obstacleShadowLeftKey:this.obstacleShadowLeftKey,obstacleShadowRightKey:this.obstacleShadowRightKey}).getSprite();i.treeType=t.type,i.typeList=t.typeList,this.treeGroup.add(i)},n.prototype.checkJames=function(t,e){if(-1==e.treeType)this.jamesObject.flyRight(!0);else if(1==e.treeType)this.jamesObject.flyLeft(!0);else{0==e.typeList[2]?this.jamesObject.flyRight(!0):this.jamesObject.flyLeft(!0)}},n.prototype.checkSofia=function(t,e){let i=this.treeConfigList.indexOf(e.typeList),s=this.treeConfigList[i-1],a=1,n=e.treeType;if(null!=s)if(0==s[n+1])a=n+1;else for(let t=0;t<s.length;t++)if(0==s[t]){a=t;break}e.hintCount?e.hintCount++:e.hintCount=1,this.hasTiped?(this.audioCharacterClash.play(),this.audioBushImpact.play(),this.sofiaDizzy&&this.sofiaSprite&&this.sofiaDizzy.position.setTo(this.dizzyX,this.dizzyY),tween.stop(tween),this.audioGallop.pause(),this.gameStop=!0,this.sofiaDizzy.visible=!0,this.add.tween(this.sofiaDizzy).to({angle:this.sofiaDizzy.angle+360},2e3,"Linear",!0).onComplete.add(function(){this.mapGroup.y-=this.distanceBack,this.flyedPosition-=this.distanceBack;let e=a-1;t.position.x=this.world.centerX+e*this.offsetX,this.sofiaObject.setPosition(e),this.isRoleTarget&&(this.jamesSprite.position.x=this.world.centerX+e*this.offsetX,this.jamesObject.setPosition(e)),this.audioGallop.resume(),this.gameStop=!1,this.sofiaDizzy.visible=!1},this)):(this.gameStop=!0,this.showFirstTip())},n.prototype.showTips=function(t=null,e){if(!this.isTiping)if(t||(t={x:this.sofiaSprite.x,y:this.sofiaSprite.y-20}),this.isTiping=!0,"slide"===this.operationType)this.gestureTiper.showSlide(t,0,function(){this.isTiping=!1,e&&e()}.bind(this));else{let t={x:this.groups.x+35,y:this.groups.y+35},i={x:this.groups.x+455,y:this.groups.y+35};this.gestureTiper.showTap(t,function(){this.gestureTiper.showTap(i,function(){this.isTiping=!1,e&&e()}.bind(this))}.bind(this))}},n.prototype.showFirstTip=function(){this.letsFly=!1,"slide"===this.operationType?this.showTips({x:this.sofiaSprite.x,y:this.sofiaSprite.y-20},function(){this.hasEffectiveOperation||this.showFirstTip()}.bind(this)):this.showTips({x:this.groups.x+230,y:this.groups.y+25},function(){this.hasEffectiveOperation||this.showFirstTip()}.bind(this)),this.hasTiped=!0},n.prototype.hideSofiaTips=function(){this.hasEffectiveOperation=!0,this.letsFly=!0,this.audioGallop.resume()},n.prototype.onDown=function(t,e){this.audioTap&&(this.audioSelect.play(),this.inputDownPoint={x:e.x,y:e.y})},n.prototype.onUp=function(t,e){if(null==this.inputDownPoint)return;if(!this.gameStart)return void this.inputDownPoint;if(this.gameScceed)return void this.inputDownPoint;if(!this.hasTiped)return void this.inputDownPoint;if(this.gameStop)return void this.inputDownPoint;this.offset=e.x-this.inputDownPoint.x,this.offset>100?this.flyRight():this.offset<-100?this.flyLeft():console.log("slide nooo"),this.inputDownPoint=null},n.prototype.TOF=function(){},n.prototype.flyLeft=function(){this.gameStart&&(this.gameScceed||this.hasTiped&&(this.gameStop||this.sofiaObject.isTurning||(this.hideSofiaTips(),-1==this.sofiaObject.getPosition()?(this.sofiaObject.flyLeft(!1),this.audioIncorrect.play(),this.audioReas.showNegativeHumm()):(this.sofiaObject.flyLeft(!0),this.audioCorrect.play(),this.audioReas.showPositiveHumm()),this.audioMove.play())))},n.prototype.flyRight=function(){this.gameStart&&(this.gameScceed||this.hasTiped&&(this.gameStop||this.sofiaObject.isTurning||(this.hideSofiaTips(),1==this.sofiaObject.getPosition()?(this.sofiaObject.flyRight(!1),this.audioIncorrect.play(),this.audioReas.showNegativeHumm()):(this.sofiaObject.flyRight(!0),this.audioCorrect.play(),this.audioReas.showPositiveHumm()),this.audioMove.play())))},n.prototype.drawEventSprite=function(t){var e=this.make.graphics(0,0);e.beginFill(0,0),e.drawRect(0,0,this.world.width,this.world.height),e.endFill(),this.clickEventSprite=this.make.sprite(0,0,e.generateTexture()),this.clickEventSprite.inputEnabled=!0,this.clickEventSprite.events.onInputDown.add(this.onDown,this),this.clickEventSprite.events.onInputUp.add(this.onUp,this),t.add(this.clickEventSprite)},n.prototype.startGame=function(){this.systemBtns.enableExitButton(),this.audioAmbience.play(),this.audioGallop.play(),"slide"===this.operationType?(this.drawEventSprite(this.contentGroup),this.contentGroup.bringToTop(this.gestureTiper)):(this.groups=new ArrowButtons(this.game,{context:this,distance:400,direction:"horizontal",leftBtnClickCallback:this.flyLeft,rightBtnClickCallback:this.flyRight}),this.groups.x=(this.world.width-this.groups.width)/2,this.groups.y=660-this.groups.height/2,this.contentGroup.addChild(this.groups),this.contentGroup.bringToTop(this.gestureTiper)),this.sofiaObject.fly(),this.offsetDis+this.offsetNor>720?this.offsetDis=720-this.offsetNor-this.sofiaSprite.height/2:this.offsetDis+this.offsetNor<0&&(this.offsetDis=200-this.offsetNor),this.add.tween(this.sofiaSprite).to({y:this.sofiaSprite.y-480+this.offsetDis},1e3,"Linear",!0).onComplete.add(function(){this.gameStart=!0},this),this.isRoleTarget&&(this.jamesObject.fly(),this.add.tween(this.jamesSprite).to({y:this.jamesSprite.y-480+this.offsetDis},1e3,"Linear",!0))},n.prototype.orientationMove=function(t){if(this.gameStart&&90==window.orientation||-90==window.orientation){let e=t.beta;e<-10&&(90==window.orientation?this.flyLeft():this.flyRight()),e>10&&(90==window.orientation?this.flyRight():this.flyLeft())}},n.prototype.gameComplete=function(){this.isTween?(this.add.tween(this.sofiaSprite).to({y:this.sofiaSprite.y-this.treeGroup.children[0].height},500,"Linear",!0).onComplete.add(function(){let t=this.sofiaObject.getPosition();1==t?(this.sofiaObject.flyLeft(!0),!this.audioMove.isPlaying&&this.audioMove.play()):-1==t&&(!this.audioMove.isPlaying&&this.audioMove.play(),this.sofiaObject.flyRight(!0)),this.add.tween(this.sofiaSprite).to({y:this.sofiaSprite.y-720},2e3,"Linear",!0).onComplete.add(function(){this.sofiaObject.destroy(),this.audioAmbience.stop(),this.audioGallop.stop(),this.audioTap=!1,this.showSuccess()},this)},this),this.isRoleTarget&&this.add.tween(this.jamesSprite).to({y:this.jamesSprite.y-this.treeGroup.children[0].height},500,"Linear",!0).onComplete.add(function(){let t=this.jamesObject.getPosition();1==t?this.jamesObject.flyLeft(!0):-1==t&&this.jamesObject.flyRight(!0),this.add.tween(this.jamesSprite).to({y:this.jamesSprite.y-720},2e3,"Linear",!0).onComplete.add(function(){this.jamesObject.destroy()},this)},this)):this.time.events.add(2e3,function(){this.audioAmbience.stop(),this.audioGallop.stop(),this.audioTap=!1,this.showSuccess()}.bind(this))},n.prototype.exitGame=function(){this.audioAmbience.stop(),this.audioGallop.stop(),this.gameScceed=!0},n.prototype.showSuccess=function(){this.gameScceed||(this.gameStart=!1,window.removeEventListener("deviceorientation",this.orientationMove.bind(this),!1),this.systemBtns.showStarBurst(this.world.centerX,this.world.centerY,function(){this.systemBtns.showEndingPage("complete")}.bind(this)))},n.prototype.getRunwayLength=function(){var t=(this.obstacleLine-1)*this.obstanceDistance;return Math.ceil(t/720)},o.prototype.initGame=function(){var t=Editor.Config.common.ratio.split("/"),e=720*t[0]/t[1];this.game=new Phaser.Game(e,720,Phaser.CANVAS,"",null,!0),this.game.Config=Editor.Config,this.game.state.add("Boot",i),this.game.state.add("Preloader",s),this.game.state.add("DifficultScene",a),this.game.state.add("GamePlay",n),this.addCommon()},o.prototype.addCommon=function(){if("production"!==Editor.env){var t=Until.getCommonThemeJs(),e=[t+"/GameControl.js",t+"/LoadProgressBar.js",t+"/GestureTiper.js",t+"/ReaxAudios.js",t+"/ProgressBar.js",t+"/ArrowButtons.js",t+"/SystemButtons.js",t+"/DifficultPage.js",t+"/DataManage.js"];Until.loadCommon(e,function(){this.startGame()}.bind(this))}else this.startGame()},o.prototype.startGame=function(){this.game.state.start("Boot")},o}(),DataManage.prototype.init=function(t){this.deviceModel=t.deviceModel,this.activityId=t.activityId,this.difficult=t.difficult,this.btnRestartNum=0,this.dataList=[],this.currData=this.initData(),this.dataList.push(this.currData)},DataManage.prototype.initData=function(){var t={dataTimeStart:0,dataTimeEnd:0,timeTotal:0,effectiveActionNum:0,faultActionNum:0,btnHelpNum:0,btnHelpFirstTime:0,btnQuitTime:0,gameFinish:0,activityScore:0,difficult:0};return t},DataManage.prototype.effectiveAction=function(){this.currData.effectiveActionNum+=1},DataManage.prototype.faultAction=function(){this.currData.faultActionNum+=1},DataManage.prototype.btnHelpAction=function(){this.currData.btnHelpNum+=1,this.currData.btnHelpFirstTime||(this.currData.currData=Date.now())},DataManage.prototype.btnBgmusicAction=function(){this.currData.btnBgmusicAction+=1,this.currData.btnBgmusicTime=Date.now()},DataManage.prototype.btnQuitAction=function(){this.currData.btnQuitTime=Date.now()},DataManage.prototype.gameFinishStatus=function(t){this.currData.gameFinish=t},DataManage.prototype.resetData=function(){this.currData=null,this.currData=this.initData(),this.dataList.push(this.currData)},DataManage.prototype.activityScore=function(t){const e=this.getActivityType(window.Editor.Config.common.template),i=this.dealActivityScore(e,t);return this.currData.activityScore=i,i},DataManage.prototype.dataTimeStart=function(){this.currData.dataTimeStart=Date.now()},DataManage.prototype.dataTimeEnd=function(t,e){this.currData.dataTimeEnd=Date.now(),this.currData.timeTotal=this.currData.dataTimeEnd-this.currData.dataTimeStart;let i=0;"skip"!==t&&(i=this.activityScore(e));const s=this.getFinishStatusValue(t,i);this.gameFinishStatus(s)},DataManage.prototype.setGameDifficult=function(t){this.currData.difficult=t+1,this.currData.difficult>this.difficult&&(this.difficult=this.currData.difficult)},DataManage.prototype.setUnloackDifficult=function(t){this.difficult=t+1},DataManage.prototype.getUserData=function(){return{activityId:this.activityId,difficult:this.difficult,gameInfo:this.dataList}},DataManage.prototype.dealActivityScore=function(t,e){switch(t){case"action":var i=this.currData.effectiveActionNum/(this.currData.faultActionNum+this.currData.effectiveActionNum)*100;return Math.round(i);case"time":return e.time>10?100:Math.round(10*e.time);case"target":i=e.clickNum/e.targetNum*100;return Math.round(i)}},DataManage.prototype.getActivityType=function(t){switch(t){case"puzzle":case"runner":case"card_matching":case"search_find":case"follow_squeence":case"tracing":case"tapping_normal":return"action";case"coloring":return"time";case"tapping":case"tapping_quick":case"tapping_flying":case"balancing":return"target"}},DataManage.prototype.getFinishStatusValue=function(t,e){switch(t){case"complete":return e>=80?1:e>=50?2:3;case"uncomplete":return 3;case"skip":return 4;default:return 0}},function(){function t(){(new Editor.Template).initGame()}window.addEventListener("load",function(){Until.getJSON("./config.json",function(e){!function(e){window.Editor.Config=e,document.title=Editor.Config.title,Editor.Template?t():Until.addScript(Until.getTemplate(),function(){t()})}(e)})})}(),window.Until={getTemplate:function(){var t=Editor.Config.common.template,e=Editor.Config.common.style;return t=Editor.path+"/template/"+t+"/js/"+e.toLowerCase()+".js"},addScript:function(t,e){var i=document.createElement("script");i.type="text/javascript",i.src=t,document.body.appendChild(i),i.onload=function(){e&&e()}},loadCommon:function(t,e){if(0===t.length)e();else{const i=t.shift();Until.addScript(i,function(){Until.loadCommon(t,e)})}},loadAssets:function(t,e){Object.keys(t).forEach(function(i){var s=t[i];if(""!==s.value&&""!==s.key){var a=Until.getGameAssetsUrl(s);switch(s.type){case"images":e.cache.checkImageKey(s.key)||e.load.image(s.key,a+s.value);break;case"atlas":e.cache.checkJSONKey(s.key)||e.load.atlasJSONArray(s.key,a+s.value,a+s.json);break;case"audio":e.cache.checkSoundKey(s.key)||e.load.audio(s.key,a+s.value)}}})},getAssetsFileName:function(t){const e=t.split("/");return e[e.length-1]},loadCommonAssets:function(t,e){Object.keys(t).forEach(function(i){var s=t[i];if(""!==s.value){var a=Until.getCommonTheme(s);switch(s.type){case"images":e.load.image(i,a+s.value);break;case"atlas":e.load.atlasJSONArray(i,a+s.value,a+s.json);break;case"audio":e.load.audio(i,a+s.value)}}})},getGameAssetsUrl:function(t){if(t.value.indexOf("/")>-1)return".";if("production"!==Editor.env){if("images"===t.type){let e=Editor.path+"/template/"+Editor.Config.common.template+"/theme/";return t.lang&&(e+=Editor.Config.common.language+"/"),e}let e=Editor.path+"/template/"+Editor.Config.common.template+"/"+t.type+"/";return t.lang&&(e+=Editor.Config.common.language+"/"),e}return"./assets/"+t.type+"/"},getCommonTheme:function(t){if("production"===Editor.env)return"./assets/"+t.type+"/";if(t.path)return Editor.path+t.path+t.type+"/";var e=Editor.path+"/common/theme/"+Editor.Config.common.theme+"/"+t.type+"/";return t.lang&&(e+=Editor.Config.common.language+"/"),e},getCommonThemeJs:function(){return"production"===Editor.env?"./":Editor.path+"/common/js"},dataFromatAsstes:function(){var t={};return Editor.Config.stages.forEach((e,i)=>{const s=e.assets;s&&Object.keys(s).forEach(e=>{var a=s[e];Array.isArray(a)?a.forEach((s,a)=>{t["stage-"+i+"_"+e+a]=s,s.key=Until.getAssetsFileName(s.value)}):(t["stage-"+i+"_"+e]=a,a.key=Until.getAssetsFileName(a.value))})}),t},isUndefined:function(t){return void 0===t},getRandomValue:function(t){return 170*t.rnd.normal()},getJSON:function(t,e){var i;(i=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onreadystatechange=function(){if(4==i.readyState&&200==i.status){var t=i.responseText;e(JSON.parse(t))}},i.open("GET",t,!0),i.send()}};